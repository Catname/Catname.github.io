I"•<h3 id="ä¸€èˆ¬éƒ¨ç½²">ä¸€èˆ¬éƒ¨ç½²</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. git clone git@xxx.xxx.com:xxxxx/xxx.git <span class="o">&amp;&amp;</span> <span class="nb">cd </span>xxx
2. composer <span class="nb">install
</span>3. <span class="nb">cp </span>env.example env.
4. php artisan key:generate
5. php artisan jwt:secret
6. <span class="c"># å¡«å†™å¥½ .env æ–‡ä»¶ä¸­çš„å„é¡¹é…ç½®ï¼Œç‰¹åˆ«æ˜¯æ•°æ®åº“ï¼ŒRedis ç­‰</span>

   <span class="c"># å¼€å‘ç¯å¢ƒè¿è¡Œæ•°æ®åº“è¿ç§»æ–‡ä»¶ å¹¶ä¸”è¿è¡Œå¡«å……æ–‡ä»¶ å¡«å……æµ‹è¯•æ•°æ®</span>
   <span class="c"># æ³¨æ„ï¼è¿è¡Œæ­¤å‘½ä»¤å‰ï¼Œè¯·å…ˆå¤‡ä»½ Laravel-admin ç®¡ç†åå°æ•°æ®ï¼Œå…·ä½“æŸ¥çœ‹æœ¬æ–‡æ¡£-å…¶ä»–æ‚é¡¹</span>
7. php artisan migrate:refresh <span class="nt">--seed</span>
   <span class="c"># æ­£å¼ç¯å¢ƒä¸éœ€è¦å¡«å……æ‰€æœ‰æ•°æ®</span>
   php artisan migrate
</code></pre></div></div>

<h3 id="å¼€å‘è§„èŒƒ">å¼€å‘è§„èŒƒ</h3>

<p>åœ¨ <a href="https://learnku.com/docs/laravel-specification/7.x/whats-the-use-of-standards/7588">Laravel é¡¹ç›®å¼€å‘è§„èŒƒ</a> çš„åŸºç¡€ä¸Šï¼ŒæŒ‰ä¸‹åˆ—è§„èŒƒè¿›è¡Œå¼€å‘ã€‚</p>

<ul>
  <li>æ•°æ®åº“<strong>å¿…é¡»</strong>ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">æ•°æ®åº“è¿ç§»æ–‡ä»¶</code> åšç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†ï¼Œæ–¹ä¾¿å¤šäººåä½œå¼€å‘å’ŒåæœŸåˆ‡æ¢æ•°æ®åº“éœ€è¦ã€‚</li>
  <li>æ‰€æœ‰é‡‘é¢ç›¸å…³çš„å­—æ®µï¼Œå­—æ®µç±»å‹ä¸º <code class="language-plaintext highlighter-rouge">int</code> å•ä½ç»Ÿä¸€ä¸º <code class="language-plaintext highlighter-rouge">åˆ†</code>ã€‚</li>
  <li>æ‰€æœ‰æ—¶é—´æ“ä½œç»Ÿä¸€ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Carbon</code> ç±»ã€‚</li>
  <li>æ¨¡å‹å…³è”åçš„å…³è”æŸ¥è¯¢<strong>å¿…é¡»</strong>ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">é¢„åŠ è½½ with()</code> é˜²æ­¢ N+1 é—®é¢˜ï¼Œé™¤éæƒ…å†µä¸å…è®¸ã€‚</li>
  <li>è·å–å½“å‰è¿è¡Œç¯å¢ƒ <code class="language-plaintext highlighter-rouge">app('env')</code> ã€‚</li>
  <li>æ·»åŠ è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œæ”¾åœ¨ <code class="language-plaintext highlighter-rouge">app/config/</code> ï¼Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">config('æ–‡ä»¶å.é”®å')</code> è·å–ç›¸å¯¹åº”çš„é…ç½®ã€‚</li>
  <li>è¡¨å•éªŒè¯ç±» ç»Ÿä¸€ç»§æ‰¿ åŸºç±» <code class="language-plaintext highlighter-rouge">BaseRequest</code> ï¼Œå› ä¸ºåŸºç±»ä¸­é‡å†™äº†è¡¨å•éªŒè¯æœªé€šè¿‡åè¿”å›çš„æ¶ˆæ¯ç»“æ„ã€‚</li>
  <li>å†™æ—¥å¿—ç”¨ Monolog ï¼Œå¯åœ¨ <code class="language-plaintext highlighter-rouge">config/logging.php</code> ä¸­è‡ªå®šä¹‰ channel å®ç°ä¸åŒæ–‡ä»¶è®°å½•ä¸åŒæ—¥å¿—ã€‚</li>
  <li>æ–°å»ºæ—¶é—´ç±»å­—æ®µä½¿ç”¨ datetime ç±»å‹ï¼Œé˜²æ­¢å‡ºç° <code class="language-plaintext highlighter-rouge">Y2K38</code> é—®é¢˜ã€‚</li>
</ul>

<h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3>

<h4 id="ä¿®æ”¹-configappphp-é…ç½®">ä¿®æ”¹ <code class="language-plaintext highlighter-rouge">config/app.php</code> é…ç½®</h4>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>

    <span class="mf">...</span>

    <span class="cm">/*
    |--------------------------------------------------------------------------
    | Application Timezone
    |--------------------------------------------------------------------------
    |
    | Here you may specify the default timezone for your application, which
    | will be used by the PHP date and date-time functions. We have gone
    | ahead and set this to a sensible default for you out of the box.
    |
    */</span>

    <span class="s1">'timezone'</span> <span class="o">=&gt;</span> <span class="s1">'Asia/Shanghai'</span><span class="p">,</span>

    <span class="cm">/*
    |--------------------------------------------------------------------------
    | Application Locale Configuration
    |--------------------------------------------------------------------------
    |
    | The application locale determines the default locale that will be used
    | by the translation service provider. You are free to set this value
    | to any of the locales which will be supported by the application.
    |
    */</span>

    <span class="s1">'locale'</span> <span class="o">=&gt;</span> <span class="s1">'zh_CN'</span><span class="p">,</span>

    <span class="cm">/*
    |--------------------------------------------------------------------------
    | Application Fallback Locale
    |--------------------------------------------------------------------------
    |
    | The fallback locale determines the locale to use when the current one
    | is not available. You may change the value to correspond to any of
    | the language folders that are provided through your application.
    |
    */</span>

    <span class="s1">'fallback_locale'</span> <span class="o">=&gt;</span> <span class="s1">'en'</span><span class="p">,</span>

    <span class="cm">/*
    |--------------------------------------------------------------------------
    | Faker Locale
    |--------------------------------------------------------------------------
    |
    | This locale will be used by the Faker PHP library when generating fake
    | data for your database seeds. For example, this will be used to get
    | localized telephone numbers, street address information and more.
    |
    */</span>

    <span class="s1">'faker_locale'</span> <span class="o">=&gt;</span> <span class="s1">'zh_CN'</span><span class="p">,</span>

    <span class="mf">...</span>

<span class="p">];</span>
</code></pre></div></div>

<h4 id="æ·»åŠ è‡ªå®šä¹‰è¾…åŠ©å‡½æ•°æ–‡ä»¶-apphelpersphp">æ·»åŠ è‡ªå®šä¹‰è¾…åŠ©å‡½æ•°æ–‡ä»¶ <code class="language-plaintext highlighter-rouge">app/helpers.php</code></h4>

<p>åœ¨ <code class="language-plaintext highlighter-rouge">composer.json</code> ä¸­æ·»åŠ ä¸‹é¢å†…å®¹</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span><span class="w">
</span><span class="nl">"autoload"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"psr-4"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">...</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"files"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"app/helpers.php"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<p>æ·»åŠ åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°åŠ è½½æ–‡ä»¶</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer dump-autoload
</code></pre></div></div>

<h4 id="è·¯ç”±åˆ†ç»„">è·¯ç”±åˆ†ç»„</h4>

<p><code class="language-plaintext highlighter-rouge">app/Providers/RouteServiceProvider.php</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">...</span>
<span class="k">public</span> <span class="k">function</span> <span class="n">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">configureRateLimiting</span><span class="p">();</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">routes</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nc">Route</span><span class="o">::</span><span class="nf">prefix</span><span class="p">(</span><span class="s1">'api'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">middleware</span><span class="p">(</span><span class="s1">'api'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">namespace</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">namespace</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">group</span><span class="p">(</span><span class="nf">base_path</span><span class="p">(</span><span class="s1">'routes/api.php'</span><span class="p">));</span>
        <span class="nc">Route</span><span class="o">::</span><span class="nf">prefix</span><span class="p">(</span><span class="s1">'api'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">middleware</span><span class="p">(</span><span class="s1">'api'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">namespace</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">namespace</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">group</span><span class="p">(</span><span class="nf">base_path</span><span class="p">(</span><span class="s1">'routes/common.php'</span><span class="p">));</span>

        <span class="nc">Route</span><span class="o">::</span><span class="nf">middleware</span><span class="p">(</span><span class="s1">'web'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">namespace</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">namespace</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">group</span><span class="p">(</span><span class="nf">base_path</span><span class="p">(</span><span class="s1">'routes/web.php'</span><span class="p">));</span>
    <span class="p">});</span>
<span class="p">}</span>
<span class="mf">...</span>
</code></pre></div></div>

<h3 id="è¯·æ±‚">è¯·æ±‚</h3>

<h4 id="è§„èŒƒè¿”å›æ ¼å¼ç»™æ‰€æœ‰-api-è¯·æ±‚åŠ ä¸Šè¯·æ±‚å¤´">è§„èŒƒè¿”å›æ ¼å¼ï¼Œç»™æ‰€æœ‰ API è¯·æ±‚åŠ ä¸Šè¯·æ±‚å¤´</h4>

<ol>
  <li>
    <p>æ–°å»ºä¸­é—´ä»¶ <code class="language-plaintext highlighter-rouge">AcceptHeader.php</code></p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">...</span>
<span class="k">public</span> <span class="k">function</span> <span class="n">handle</span><span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">Closure</span> <span class="nv">$next</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">headers</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'Accept'</span><span class="p">,</span> <span class="s1">'application/json'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
<span class="p">}</span>
<span class="mf">...</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>æ³¨å†Œä¸­é—´ä»¶ <code class="language-plaintext highlighter-rouge">app/Http/Kernel.php</code></p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">...</span>
<span class="k">protected</span> <span class="nv">$middlewareGroups</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'web'</span> <span class="o">=&gt;</span> <span class="p">[</span>
           <span class="mf">...</span>
    <span class="p">],</span>
   
    <span class="s1">'api'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="err">\</span><span class="nc">App\Http\Middleware\AcceptHeader</span><span class="o">::</span><span class="n">class</span><span class="p">,</span>
        <span class="mf">...</span>
    <span class="p">],</span>
<span class="p">];</span>
<span class="mf">...</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="è·¯ç”±">è·¯ç”±</h3>

<h4 id="æ¨¡å‹å­˜åœ¨å´æŠ›å‡º-no-query-results-for-model-appmodelsxxxx-å¼‚å¸¸">æ¨¡å‹å­˜åœ¨ï¼Œå´æŠ›å‡º <code class="language-plaintext highlighter-rouge">No query results for model [App\\Models\\xxxx]</code> å¼‚å¸¸</h4>

<p>è¿™ä¸ªé€šå¸¸ç”±è·¯ç”±ç»‘å®šå‡ºçš„é—®é¢˜ï¼Œæ³¨æ„æœ‰ç»‘å®šæ¨¡å‹çš„è·¯ç”±ï¼ŒåŒè·¯å¾„çš„è·¯ç”±éœ€è¦æ”¾åœ¨æ²¡ç»‘å®šè·¯ç”±çš„åé¢</p>

<p>ä¾‹å¦‚ï¼š/posts/create å’Œ /posts/{post} çš„æ˜¯åŒè·¯å¾„ï¼Œ/posts/{post} å¿…é¡»æ”¾åœ¨ /posts/create åé¢</p>

<p>ä¸€å®šæ³¨æ„è·¯ç”±çš„å…ˆåé¡ºåº</p>

<h3 id="ç®¡é“-pipeline">ç®¡é“ Pipeline</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">public</span> <span class="k">function</span> <span class="n">create</span><span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$pipes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nc">RemoveBadWords</span><span class="o">::</span><span class="n">class</span><span class="p">,</span>
        <span class="nc">ReplaceLinkTags</span><span class="o">::</span><span class="n">class</span><span class="p">,</span>
        <span class="nc">RemoveScriptTags</span><span class="o">::</span><span class="n">class</span>
    <span class="p">];</span>
    <span class="nv">$post</span> <span class="o">=</span> <span class="nf">app</span><span class="p">(</span><span class="nc">Pipeline</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nf">send</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="n">content</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nf">through</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nf">then</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$content</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nc">Post</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span><span class="s1">'content'</span> <span class="o">=&gt;</span> <span class="s1">'content'</span><span class="p">]);</span>
        <span class="p">});</span>
    <span class="c1">// return any type of response</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="ä¸­é—´ä»¶">ä¸­é—´ä»¶</h3>

<h4 id="è·å–å½“å‰è¯·æ±‚çš„-url">è·å–å½“å‰è¯·æ±‚çš„ URL</h4>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ä¸å¸¦ä¸»æœºåŸŸåå’Œå‚æ•°</span>
<span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">path</span><span class="p">();</span>          <span class="c1">//ç»“æœï¼š api/home/test</span>

<span class="c1">// ä¸å¸¦ä¸»æœºåŸŸåï¼Œå¸¦ query å‚æ•°</span>
<span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">getRequestUrl</span><span class="p">();</span> <span class="c1">//ç»“æœï¼š /api/home/test?id=1</span>

<span class="c1">// å¸¦ä¸»æœºåŸŸåï¼Œä¸å¸¦ query å‚æ•°</span>
<span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">url</span><span class="p">();</span>           <span class="c1">//ç»“æœï¼š http://xxx.test/api/home/test</span>
<span class="c1">// æ³¨æ„æœ€å‰é¢ '/' çš„åŒºåˆ«</span>
</code></pre></div></div>

<h4 id="è·å–å½“å‰è¯·æ±‚çš„-http-method">è·å–å½“å‰è¯·æ±‚çš„ HTTP Method</h4>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">method</span><span class="p">();</span> <span class="c1">//ç»“æœï¼š POST</span>
</code></pre></div></div>

<h3 id="æ•è·å¼‚å¸¸">æ•è·å¼‚å¸¸</h3>

<h4 id="æ•è·ç¡®åˆ‡çš„æ•°æ®åº“é”™è¯¯">æ•è·ç¡®åˆ‡çš„æ•°æ®åº“é”™è¯¯</h4>

<p>å¦‚æœæ‚¨æƒ³æ•è· Eloquent Query å¼‚å¸¸ï¼Œè¯·ä½¿ç”¨ç‰¹å®šçš„ <code class="language-plaintext highlighter-rouge">QueryException</code> ä»£æ›¿é»˜è®¤çš„ Exception ç±»ï¼Œæ‚¨å°†èƒ½å¤Ÿè·å¾—é”™è¯¯çš„ç¡®åˆ‡ SQL ä»£ç ã€‚</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="p">{</span>
    <span class="c1">// ä¸€äº› Eloquent/SQL å£°æ˜</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="err">\</span><span class="nc">Illuminate\Database\QueryException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="nf">getCode</span><span class="p">()</span> <span class="o">===</span> <span class="s1">'23000'</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// integrity constraint violation</span>
        <span class="k">return</span> <span class="nf">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">withError</span><span class="p">(</span><span class="s1">'Invalid data'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="æ§åˆ¶å™¨">æ§åˆ¶å™¨</h3>

<h4 id="æ¨¡å‹ä¾èµ–æ³¨å…¥">æ¨¡å‹ä¾èµ–æ³¨å…¥</h4>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">App\Http\Controllers</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ExampleController</span> <span class="kd">extends</span> <span class="nc">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">show</span><span class="p">(</span><span class="kt">Model</span> <span class="nv">$model</span><span class="p">)</span>
	<span class="p">{</span>
        <span class="mf">...</span>
    	<span class="c1">// å¦‚æœéœ€è¦å…³è”æŸ¥è¯¢</span>
        <span class="nv">$model</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="s1">'relation'</span><span class="p">);</span>
        <span class="mf">...</span>
	<span class="p">}</span>
    <span class="mf">...</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="æœåŠ¡æä¾›è€…">æœåŠ¡æä¾›è€…</h3>

<h4 id="åˆ›å»º">åˆ›å»º</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:provider NotificationServiceProvider
</code></pre></div></div>

<h4 id="æ³¨å†Œ-configappphp">æ³¨å†Œ <code class="language-plaintext highlighter-rouge">config/app.php</code></h4>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>
    <span class="mf">...</span>
    <span class="s1">'providers'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="mf">...</span>
        <span class="nc">App\Providers\NotificationServiceProvider</span><span class="o">::</span><span class="n">class</span><span class="p">,</span>
        <span class="mf">...</span>
    <span class="p">],</span>
    <span class="mf">...</span>
<span class="p">];</span>
</code></pre></div></div>

<h4 id="ç”¨ä¾‹ç›‘å¬æ—¥å¿—æŒ‡å®šç­‰çº§æ—¥å¿—æ¨é€æ¶ˆæ¯">ç”¨ä¾‹ï¼šç›‘å¬æ—¥å¿—ï¼ŒæŒ‡å®šç­‰çº§æ—¥å¿—æ¨é€æ¶ˆæ¯</h4>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Providers</span><span class="p">;</span>

<span class="kn">use</span> <span class="n">App\Jobs\noticeIssue</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\ServiceProvider</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">NotificationServiceProvider</span> <span class="kd">extends</span> <span class="nc">ServiceProvider</span>
<span class="p">{</span>
    <span class="mf">...</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="err">\</span><span class="nc">Log</span><span class="o">::</span><span class="nf">listen</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// è¿™é‡Œç›‘å¬åˆ°æ—¥å¿—åï¼Œåˆ¤æ–­æ—¥å¿—çš„ç­‰çº§ï¼Œç„¶ååšç›¸åº”å¤„ç†</span>
            <span class="nv">$noticeMsg</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">'level'</span>   <span class="o">=&gt;</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="n">level</span><span class="p">,</span> <span class="c1">// æ—¥å¿—çš„ç­‰çº§</span>
                <span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="n">message</span><span class="p">,</span>
                <span class="s1">'context'</span> <span class="o">=&gt;</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="n">context</span><span class="p">,</span>
            <span class="p">];</span>
            <span class="nv">$data</span> <span class="o">=</span> <span class="p">[</span>
                <span class="c1">// æ¨é€æ•°æ®</span>
            <span class="p">];</span>
            <span class="n">noticeIssue</span><span class="o">::</span><span class="nf">dispatch</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">onQueue</span><span class="p">(</span><span class="s1">'issues'</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<h3 id="æ•°æ®åº“æ“ä½œ">æ•°æ®åº“æ“ä½œ</h3>

<h4 id="æ›´æ–°-json-å­—æ®µ">æ›´æ–° JSON å­—æ®µ</h4>

<p>æ›´æ–° JSON å­—æ®µæ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">-&gt;</code> è¯­æ³•è®¿é—® JSON å¯¹è±¡ä¸­ç›¸åº”çš„å€¼ã€‚æ³¨æ„ï¼Œæ­¤æ“ä½œåªèƒ½æ”¯æŒ MySQL 5.7+ å’Œ PostgreSQL 9.5+ ï¼š</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$affected</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span>
              <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
              <span class="o">-&gt;</span><span class="nf">update</span><span class="p">([</span><span class="s1">'options-&gt;enabled'</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">]);</span>
</code></pre></div></div>

<h3 id="artisan-å‘½ä»¤">Artisan å‘½ä»¤</h3>

<h4 id="å‘½ä»¤ä½¿ç”¨å‚æ•°-è¯¦æƒ…å‚è€ƒ">å‘½ä»¤ä½¿ç”¨å‚æ•° <a href="https://learnku.com/docs/laravel/8.5/artisan/10381#arguments">è¯¦æƒ…å‚è€ƒ</a></h4>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Console\Commands</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Console\Command</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Cache</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Test</span> <span class="kd">extends</span> <span class="nc">Command</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$signature</span> <span class="o">=</span> <span class="s1">'example:test {--test}'</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s1">'å‚æ•°ç¤ºèŒƒ'</span><span class="p">;</span>
    <span class="mf">...</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">handle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// è·å–é€‰é¡¹çš„å€¼</span>
        <span class="nv">$option</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">option</span><span class="p">(</span><span class="s1">'test'</span><span class="p">);</span>
        <span class="c1">// $this-&gt;argument('argument') è·å–å‚æ•°çš„å€¼</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="é›†åˆ">é›†åˆ</h3>

<h4 id="ä¸¾ä¾‹">ä¸¾ä¾‹</h4>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">protected</span> <span class="k">function</span> <span class="n">shouldPassThrough</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ä¸‹é¢è¿™äº›è·¯ç”±ä¸éªŒè¯æƒé™</span>
        <span class="nv">$excepts</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nf">config</span><span class="p">(</span><span class="s1">'admin.auth.excepts'</span><span class="p">,</span> <span class="p">[]),</span> <span class="p">[</span>
            <span class="s1">'authorizations'</span><span class="p">,</span> <span class="c1">// ç™»å½•</span>
            <span class="s1">'authorizations/current'</span><span class="p">,</span> <span class="c1">// åˆ·æ–° Token // æ³¨é”€</span>
        <span class="p">]);</span>
        <span class="k">return</span> <span class="nf">collect</span><span class="p">(</span><span class="nv">$excepts</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">map</span><span class="p">(</span><span class="s1">'admin_base_path'</span><span class="p">)</span><span class="c1">// åŠ ä¸Šå‰ç¼€</span>
            <span class="o">-&gt;</span><span class="nf">contains</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$except</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// å»æ‰æœ€å‰é¢çš„ '/'</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$except</span> <span class="o">!==</span> <span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$except</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$except</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">);</span>
                <span class="p">}</span>
                
                <span class="k">return</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">is</span><span class="p">(</span><span class="nv">$except</span><span class="p">);</span>
            <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div></div>

<h5 id="map">map</h5>

<h5 id="contains">contains</h5>

<h3 id="é˜Ÿåˆ—">é˜Ÿåˆ—</h3>

<h4 id="æ‰‹åŠ¨å¤±è´¥">æ‰‹åŠ¨å¤±è´¥</h4>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">fail</span><span class="p">(</span><span class="s1">'é˜Ÿåˆ—å¤±è´¥ã€‚'</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="orm-æ¨¡å‹">ORM æ¨¡å‹</h3>

<h4 id="æ ¹æ®å­è¡¨çš„å€¼ç­›é€‰ä¸»è¡¨çš„é¡¹-model-with-wherehas-">æ ¹æ®å­è¡¨çš„å€¼ç­›é€‰ä¸»è¡¨çš„é¡¹ Model-&gt;with()-&gt;whereHas() *</h4>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$permissions</span> <span class="o">=</span> <span class="nc">User</span><span class="o">::</span><span class="nf">select</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">)</span>
    			<span class="o">-&gt;</span><span class="nf">with</span><span class="p">(</span><span class="s1">'roles.permissions:id,name,title'</span><span class="p">)</span>
    			<span class="o">-&gt;</span><span class="nf">whereHas</span><span class="p">(</span><span class="s1">'roles'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Builder</span> <span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'model_id'</span><span class="p">,</span><span class="nf">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">())</span>
                          <span class="o">-&gt;</span><span class="nf">select</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span><span class="s1">'name'</span><span class="p">,</span><span class="s1">'title'</span><span class="p">);</span>
        		<span class="p">})</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>

<p>ä¸»è¡¨åœ¨ åªæœ‰å­—è¡¨ä¸­ model_id ä¸ºæŒ‡å®šå€¼æ—¶æ‰ä¼šè¢«æŸ¥å‡ºæ¥ã€‚</p>

<h4 id="åµŒå¥—é¢„åŠ è½½">åµŒå¥—é¢„åŠ è½½</h4>

<p>åœ¨ä¸€ä¸ª Eloquent è¯­å¥ä¸­é¢„åŠ è½½æ‰€æœ‰ä¹¦ç±ä½œè€…åŠå…¶è”ç³»æ–¹å¼ï¼š</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$books</span> <span class="o">=</span> <span class="nc">Book</span><span class="o">::</span><span class="nf">with</span><span class="p">(</span><span class="s1">'author.contacts'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>

<p>book çš„å…³è” author çš„å…³è” contacts</p>

<h4 id="å¤šå¯¹å¤šå…³è”">å¤šå¯¹å¤šå…³è”</h4>

<p>ç»™å½“å‰é¡¹ç›®æ·»åŠ ç”¨æˆ· id ä¸º 1 çš„ä¸­é—´å…³è”æ•°æ®ï¼Œå¹¶ä¸”é™„åŠ  user_type å­—æ®µ</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$project</span><span class="o">-&gt;</span><span class="nf">allusers</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">attach</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s1">'user_type'</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">]);</span>
</code></pre></div></div>

<p>åˆ é™¤ç”¨æˆ· id ä¸º 1 çš„ä¸­é—´å…³è”æ•°æ®ï¼Œæ³¨æ„ï¼Œå½“å‰é¡¹ç›®ä¸‹æ‰€æœ‰ id ä¸º 1 çš„éƒ½ä¼šè¢«åˆ é™¤ï¼Œ<strong>ä¸é€‚ç”¨äºä¸€ä¸ªé¡¹ç›®ä¸‹æœ‰å¤šä¸ªä¸åŒ user_type ä½†ç›¸åŒç”¨æˆ· id çš„æƒ…å†µ</strong></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$project</span><span class="o">-&gt;</span><span class="nf">allusers</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">detach</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="ç”¨æˆ·æˆæƒç­–ç•¥ç±»-policy">ç”¨æˆ·æˆæƒç­–ç•¥ç±» (Policy)</h3>

<p>å¿…é¡»åœ¨åŒåæ§åˆ¶å™¨ä¸­æ‰ä¼šç”Ÿæ•ˆï¼Ÿï¼Ÿ</p>

<h4 id="æ³¨æ„ç¥å‘å¦‚æœåœ¨ç”¨æˆ·æˆæƒç­–ç•¥ç±»ä¸­æŸ¥è¯¢è¿‡å…³è”æ¨¡å‹é‚£ä¹ˆå…³è”æ¨¡å‹ä¼šè¢«åŠ å…¥ç»“æœé›†ä¸­éœ€è¦åœ¨è¿”å›å‰è°ƒç”¨-model-unsetrelationrelationname-å»æ‰">æ³¨æ„ç¥å‘ï¼ï¼å¦‚æœåœ¨ç”¨æˆ·æˆæƒç­–ç•¥ç±»ä¸­æŸ¥è¯¢è¿‡å…³è”æ¨¡å‹ï¼Œé‚£ä¹ˆå…³è”æ¨¡å‹ä¼šè¢«åŠ å…¥ç»“æœé›†ä¸­ï¼Œéœ€è¦åœ¨è¿”å›å‰è°ƒç”¨ <code class="language-plaintext highlighter-rouge">$model-&gt;unsetRelation('relationName')</code> å»æ‰ã€‚</h4>

<h3 id="æ¨¡å‹è§‚å¯Ÿè€…-observer"><a href="https://learnku.com/docs/laravel/8.5/eloquent/10409#cab083">æ¨¡å‹è§‚å¯Ÿè€… (Observer)</a></h3>

<h4 id="ä½¿ç”¨">ä½¿ç”¨</h4>

<p>ç”Ÿæˆè§‚å¯Ÿè€…ç±»</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:observer UserObserver <span class="nt">--model</span><span class="o">=</span>User
</code></pre></div></div>

<p>åœ¨ <code class="language-plaintext highlighter-rouge">AppServiceProvider</code> æœåŠ¡æä¾›è€…ä¸­æ³¨å†Œè§‚å¯Ÿè€…</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">App\Models\User</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Observers\UserObserver</span><span class="p">;</span>

<span class="cd">/**
 * Register any events for your application.
 *
 * @return void
 */</span>
<span class="k">public</span> <span class="k">function</span> <span class="n">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nc">User</span><span class="o">::</span><span class="nf">observe</span><span class="p">(</span><span class="nc">UserObserver</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="è°ƒç”¨é¡ºåº">è°ƒç”¨é¡ºåº</h4>

<p>modelA<br />
ObserverA</p>

<p>ç›‘å¬ modelA çš„ created äº‹ä»¶</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$A</span> <span class="o">=</span> <span class="no">MODELA</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>

<span class="n">next</span>
</code></pre></div></div>

<p>å®é™…è¿è¡Œé¡ºåº<br />
create-&gt;observer-&gt;next</p>

<h4 id="è¸©è¿‡çš„å‘">è¸©è¿‡çš„å‘</h4>

<h5 id="å‘1">å‘1</h5>

<h6 id="é—®é¢˜åœºæ™¯å·¥å•ç³»ç»Ÿå¾®ä¿¡ç™»å½•è¿”å›é¢„æœŸå¤–æ•°æ®å‰å°ç”¨æˆ·ç™»å½•ä¸€åˆ‡æ­£å¸¸åå°ç”¨æˆ·ç™»å½•ä¼šå¤šè¿”å›åå°ç”¨æˆ·çš„è§’è‰²ä¿¡æ¯ä½†æ˜¯ç™»å½•æ§åˆ¶å™¨é‡Œé¢æ²¡æœ‰ä»»ä½•å’Œ-roles-æœ‰å…³çš„ä»£ç ">é—®é¢˜åœºæ™¯ï¼šå·¥å•ç³»ç»Ÿå¾®ä¿¡ç™»å½•è¿”å›é¢„æœŸå¤–æ•°æ®ï¼Œå‰å°ç”¨æˆ·ç™»å½•ä¸€åˆ‡æ­£å¸¸ï¼Œåå°ç”¨æˆ·ç™»å½•ä¼šå¤šè¿”å›åå°ç”¨æˆ·çš„è§’è‰²ä¿¡æ¯ï¼Œä½†æ˜¯ç™»å½•æ§åˆ¶å™¨é‡Œé¢æ²¡æœ‰ä»»ä½•å’Œ roles æœ‰å…³çš„ä»£ç </h6>

<p>å‰å°æ™®é€šç”¨æˆ·ç™»å½•åè¿”å›ï¼š</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
          </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
          </span><span class="nl">"messages"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ç™»å½•æˆåŠŸ"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwczpcL1wvaXNzdWVjcy5xaWZ1eGlvbmcuY29tXC9hcGlcL3dlY2hhdFwvYXV0aG9yaXphdGlvbnMiLCJpYXQiOjE2Mzk5OTI2NTgsImV4cCI6MTYzOTk5OTg1OCwibmJmIjoxNjM5OTkyNjU4LCJqdGkiOiJoc1NLMFptRGRrZGl0RDlRIiwic3ViIjoxNCwicHJ2IjoiMjNiZDVjODk0OWY2MDBhZGIzOWU3MDFjNDAwODcyZGI3YTU5NzZmNyIsInJvbGUiOiJ1c2VyIn0.GEUahFc4XlxaFvdV4MclSJ4CvLCCdOKKJGQwvZ04I5s"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"expires"</span><span class="p">:</span><span class="w"> </span><span class="mi">1639999858</span><span class="p">,</span><span class="w">
          </span><span class="nl">"is_binding_mobile"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="nl">"is_staff"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="nl">"userInfo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w">
              </span><span class="nl">"nick_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"æ˜µç§°"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"real_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ç‹è€äº”"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"mobile"</span><span class="p">:</span><span class="w"> </span><span class="s2">"18888888888"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"account_status"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
              </span><span class="nl">"avatar_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epk6XJfVGqsW5y4zFjzWy3SvYN1KRHQYLTKGnbUanOfBeW4sR0z6ZyNBgtCVmOceicTlnyBcaTPbWA/132"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"gender"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
              </span><span class="nl">"company"</span><span class="p">:</span><span class="w"> </span><span class="s2">"æˆéƒ½å¸‚ä¼æœç†Šç§‘æŠ€æœ‰é™å…¬å¸"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"job"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PHPåç«¯"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-12-20 16:26:37"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-12-20 17:30:58"</span><span class="w">
          </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>åå°ç”¨æˆ·å¾®ä¿¡ç™»å½•åè¿”å›</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
          </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
          </span><span class="nl">"messages"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ç™»å½•æˆåŠŸ"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwczpcL1wvaXNzdWVjcy5xaWZ1eGlvbmcuY29tXC9hcGlcL3dlY2hhdFwvYXV0aG9yaXphdGlvbnMiLCJpYXQiOjE2Mzk5OTI2NTgsImV4cCI6MTYzOTk5OTg1OCwibmJmIjoxNjM5OTkyNjU4LCJqdGkiOiJoc1NLMFptRGRrZGl0RDlRIiwic3ViIjoxNCwicHJ2IjoiMjNiZDVjODk0OWY2MDBhZGIzOWU3MDFjNDAwODcyZGI3YTU5NzZmNyIsInJvbGUiOiJ1c2VyIn0.GEUahFc4XlxaFvdV4MclSJ4CvLCCdOKKJGQwvZ04I5s"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"expires"</span><span class="p">:</span><span class="w"> </span><span class="mi">1639999858</span><span class="p">,</span><span class="w">
          </span><span class="nl">"is_binding_mobile"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="nl">"is_staff"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="nl">"userInfo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w">
              </span><span class="nl">"nick_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"æ˜µç§°"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"real_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ç‹è€äº”"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"mobile"</span><span class="p">:</span><span class="w"> </span><span class="s2">"18888888888"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"account_status"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
              </span><span class="nl">"avatar_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epk6XJfVGqsW5y4zFjzWy3SvYN1KRHQYLTKGnbUanOfBeW4sR0z6ZyNBgtCVmOceicTlnyBcaTPbWA/132"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"gender"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
              </span><span class="nl">"company"</span><span class="p">:</span><span class="w"> </span><span class="s2">"æˆéƒ½å¸‚ä¼æœç†Šç§‘æŠ€æœ‰é™å…¬å¸"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"job"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PHPåç«¯"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-12-20 16:26:37"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-12-20 17:30:58"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"roles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                  </span><span class="p">{</span><span class="w">
                      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"basicUser"</span><span class="p">,</span><span class="w">
                      </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"åŸºç¡€ç”¨æˆ·"</span><span class="p">,</span><span class="w">
                      </span><span class="nl">"guard_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"api"</span><span class="p">,</span><span class="w">
                      </span><span class="nl">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-12-17 16:36:08"</span><span class="p">,</span><span class="w">
                      </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-12-17 16:36:08"</span><span class="p">,</span><span class="w">
                      </span><span class="nl">"pivot"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                          </span><span class="nl">"model_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w">
                          </span><span class="nl">"role_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                          </span><span class="nl">"model_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"App</span><span class="se">\\</span><span class="s2">Models</span><span class="se">\\</span><span class="s2">User"</span><span class="w">
                      </span><span class="p">}</span><span class="w">
                  </span><span class="p">}</span><span class="w">
              </span><span class="p">]</span><span class="w">
          </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h6 id="äº§ç”ŸåŸå› ">äº§ç”ŸåŸå› </h6>

<p>åå°æœ‰ä¸€ä¸ªåŸºç¡€ç”¨æˆ·æƒé™ï¼Œåœ¨æ·»åŠ å’Œæ›´æ–°ç”¨æˆ·çš„æ—¶å€™ä¼šé€šè¿‡ç”¨æˆ·æ¨¡å‹ç›‘å¬å™¨ç›‘å¬åˆ°äº‹ä»¶ï¼Œç„¶åæ·»åŠ æƒé™ï¼Œäº§ç”Ÿè¿™ä¸ªé—®é¢˜çš„åŸå› åœ¨ æ›´æ–°äº‹ä»¶ï¼Œç›‘å¬åˆ°æ›´æ–°äº‹ä»¶åï¼Œä¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰åŸºç¡€æƒé™ï¼Œå¦‚æœæ²¡æœ‰åˆ™åŠ ä¸Šï¼Œåœ¨æ£€æŸ¥ä¹‹åï¼Œä¼šå°† roles åŠ å…¥åˆ° user çš„ç»“æœé›†ä¸­ã€‚</p>

<h6 id="è§£å†³åŠæ³•">è§£å†³åŠæ³•</h6>

<ol>
  <li>
    <p>åœ¨æ¨¡å‹ç›‘å¬å™¨æ›´æ–°äº‹ä»¶ä¸­ï¼Œå¤„ç†å®Œåï¼Œæ‰§è¡Œ <code class="language-plaintext highlighter-rouge">$model-&gt;unsetRelation('roles');</code></p>
  </li>
  <li>
    <p>åœ¨ä¸éœ€è¦è¿”å› roles çš„åœ°æ–¹ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">$model-&gt;unsetRelation('roles');</code></p>
  </li>
</ol>

<p>æ¨èä½¿ç”¨æ–¹æ³• 1</p>

<h3 id="composer">Composer</h3>

<h4 id="çº¿ä¸ŠæœåŠ¡å™¨æ›´æ–°æŒ‡å®š-composer-åŒ…">çº¿ä¸ŠæœåŠ¡å™¨æ›´æ–°æŒ‡å®š Composer åŒ…</h4>

<ol>
  <li>
    <p>åœ¨æœ¬åœ°è¿è¡Œ</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer update xxx/xxxxxxxx
</code></pre></div>    </div>
  </li>
  <li>
    <p>å°†æ›´æ–°åçš„  <code class="language-plaintext highlighter-rouge">composer.lock</code> æ–‡ä»¶æäº¤åˆ°æœåŠ¡å™¨</p>
  </li>
  <li>
    <p>æœåŠ¡å™¨ç»ˆç«¯è¿è¡Œ</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer <span class="nb">install</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="é’‰é’‰">é’‰é’‰</h3>

<h4 id="å•èŠæœºå™¨äºº">å•èŠæœºå™¨äºº</h4>

<p>æŒ‰æ–‡æ¡£ä¼ å‚æ•°ä¼šæç¤ºï¼šå‘é€å¯äº¤äº’å¡ç‰‡çš„æ—¶å€™æç¤º éåœºæ™¯ç¾¤ï¼›</p>

<p>è§£å†³æ–¹æ³•ï¼šæœºå™¨äººåº”è¯¥ç”¨   appKey ï¼šæœºå™¨äººappKey</p>

<h4 id="å›è°ƒäº‹ä»¶åŠ è§£å¯†">å›è°ƒäº‹ä»¶åŠ è§£å¯†</h4>

<h5 id="äº‹ä»¶è®¢é˜…æ³¨å†Œ">äº‹ä»¶è®¢é˜…æ³¨å†Œ</h5>

<p>åœ¨æ³¨å†Œæ—¶ä¸è¦æŒ‰ç…§æ–‡æ¡£è¯´çš„ç”¨ä¼ä¸š corpIdï¼Œè€Œæ˜¯ç”¨è‡ªå»ºåº”ç”¨çš„ appKeyï¼Œå¦åˆ™ä¼šæŠ¥ AES è§£å¯†é”™è¯¯</p>

<p>æ³¨å†Œä»£ç </p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
	<span class="nv">$crypt</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DingCallbackCrypto</span><span class="p">();</span>
    <span class="nv">$text</span> <span class="o">=</span> <span class="nv">$crypt</span><span class="o">-&gt;</span><span class="nf">getDecryptMsg</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="n">msg_signature</span><span class="p">,</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">timestamp</span><span class="p">,</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">nonce</span><span class="p">,</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">encrypt</span><span class="p">);</span>
    <span class="err">\</span><span class="nc">Log</span><span class="o">::</span><span class="nf">channel</span><span class="p">(</span><span class="s1">'hotlog'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">debug</span><span class="p">(</span><span class="nv">$text</span><span class="p">);</span>
    <span class="nv">$res</span> <span class="o">=</span> <span class="nv">$crypt</span><span class="o">-&gt;</span><span class="nf">getEncryptedMap</span><span class="p">(</span><span class="s2">"success"</span><span class="p">);</span>
	<span class="c1">//return response($res);</span>
    <span class="nv">$data</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$res</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="å…¶ä»–æ‚é¡¹æŠ€å·§">å…¶ä»–æ‚é¡¹ï¼ŒæŠ€å·§</h3>

<ul>
  <li>
    <p>æœ¬åœ°å¼€å‘è°ƒæ¥å£çš„æ—¶å€™ï¼Œéœ€è¦å¸¦ä¸Š JWT-Token ,å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ Artisan å‘½ä»¤ï¼ˆ<code class="language-plaintext highlighter-rouge">php artisan</code> å‘½ä»¤å¯ä»¥çœ‹åˆ°å½“å‰æ‰€æœ‰çš„ artisan å‘½ä»¤ï¼‰ç”Ÿæˆæœ‰æ•ˆæœŸä¸€å¹´çš„JWT-Tokenï¼Œå°† Token å­˜å…¥å¼€å‘ç¯å¢ƒå˜é‡ä¸­ï¼ˆ Postman ç­‰ï¼‰</p>
  </li>
  <li>
    <p>è·å–è‡ªå·±ï¼ˆæœåŠ¡ç«¯ï¼‰çš„ IP åœ°å€ï¼š<code class="language-plaintext highlighter-rouge">\request()-&gt;server('SERVER_ADDR');</code></p>
  </li>
  <li>
    <p>æœ¬åœ°å¼€å‘è‡ªå®šä¹‰ç½‘å€çš„æ—¶å€™ä¸èƒ½ä»¥ .dev ç»“å°¾ï¼Œå¦åˆ™ Chrome ä¼šå¼ºåˆ¶è·³è½¬ https æŠ¥è¯ä¹¦é”™è¯¯ã€‚</p>
  </li>
  <li>
    <p>åœ¨è¿è¡Œ <code class="language-plaintext highlighter-rouge">php artisan migrate:refresh --seed</code> ä¹‹å‰ï¼Œæ³¨æ„å¤‡ä»½ laravel-admin åå°æ•°æ® <code class="language-plaintext highlighter-rouge">php artisan admin:export-seed</code></p>
  </li>
  <li>
    <p>æ³¨æ„åœ¨éœ€è¦ç™»å½•çŠ¶æ€çš„æ§åˆ¶å™¨çš„æ„é€ æ–¹æ³•ä¸­åŠ è½½ api ä¸­é—´ä»¶ï¼ˆå¦‚æœè·¯ç”±ä¸­å·²ç»åŠ è½½ auth:api ä¸­é—´ä»¶ï¼Œåˆ™ä¸éœ€è¦åœ¨æ§åˆ¶å™¨ä¸­å•ç‹¬åŠ è½½ï¼‰ï¼Œè¿™æ ·æˆæƒç­–ç•¥ç±»ç­‰ï¼Œæ‰èƒ½é€šè¿‡ JWT-Token è·å–åˆ°å½“å‰ç™»å½•çš„ç”¨æˆ· <code class="language-plaintext highlighter-rouge">$this-&gt;middleware('auth:api');</code></p>
  </li>
  <li>
    <p>è¿”å›ç”¨æˆ·ä¿¡æ¯ç›¸å…³ï¼Œç»Ÿä¸€ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">UserResource</code> å¯¹æ•æ„Ÿä¿¡æ¯è¿›è¡Œäº†è„±æ•ï¼Œå¦‚æœå› ä¸ºä¸šåŠ¡éœ€è¦ï¼Œå¯ä»¥è¿™æ ·æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯ <code class="language-plaintext highlighter-rouge">return (new UserResource($user))-&gt;additional(['code' =&gt; 200, 'messages' =&gt; 'success'])-&gt;showSensitiveFields();</code></p>
  </li>
  <li>
    <p>ï¼ï¼æ³¨æ„è®¿é—®å™¨è¿™ä¸ªå¤©å‘ï¼ï¼å¼ºçƒˆå»ºè®®æ‰€æœ‰ status ç›¸å…³çš„åˆ¤æ–­éƒ½ç”¨ <code class="language-plaintext highlighter-rouge">getRawOriginal()</code> è·å–åŸå§‹å€¼ï¼Œé¿å…å› ä¸ºæœ‰è®¿é—®å™¨å¯¼è‡´åˆ¤æ–­é”™è¯¯ï¼Œä¸šåŠ¡å‡ºç° bug ã€‚åœ¨ Laravel 7 ä»¥åï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨è®¿é—®å™¨è¿”å›çš„æ•°æ®ï¼Œå¯ä»¥ç”¨ <code class="language-plaintext highlighter-rouge">$model-&gt;getRawOriginal('å­—æ®µå')</code> è·å–åŸå§‹æ•°æ®ã€‚(Laravel 7 ä¹‹å‰çš„ç‰ˆæœ¬æ˜¯ <code class="language-plaintext highlighter-rouge">getOriginal()</code> )ï¼Œé€šè¿‡å…³è”æ¨¡å‹æŸ¥è¯¢ä¹Ÿå¯ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">$model-&gt;relationships-&gt;getRawOriginal('å­—æ®µå')</code></p>
  </li>
  <li>
    <p>æ³¨æ„ Laravel-Admin å¯èƒ½ä¼šå ç”¨ åä¸º admin çš„ guard ï¼Œå¦‚æœè¦æ–°å¢è‡ªå®šä¹‰ guard ï¼Œé¿å…ä½¿ç”¨ admin è¿™ä¸ªåå­—ã€‚</p>
  </li>
  <li>
    <p>æ³¨æ„åœ¨è¿”å›æ¨¡å‹å‰ï¼Œå¦‚æœå¯¹æ¨¡å‹è¿›è¡Œè¿‡å…³è”æŸ¥è¯¢ï¼Œå…³è”æŸ¥è¯¢çš„æ•°æ®ä¼šè¢«æ·»åŠ åˆ°æ¨¡å‹ä¸­ï¼Œå¦‚æœåé¢ä¸éœ€è¦è¿™äº›æ•°æ®ï¼Œè®°å¾—åœ¨å…³è”æŸ¥è¯¢å®Œæˆåï¼Œç›´æ¥è°ƒç”¨ unsetRelation()ã€‚</p>
  </li>
  <li>
    <p>é€šè¿‡ <code class="language-plaintext highlighter-rouge">Carbon::now()-&gt;getPreciseTimestamp()</code> å¯ä»¥è·å–æŒ‡å®šç²¾åº¦çš„æ—¶é—´æˆ³ã€‚</p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
* @example getPreciseTimestamp()   1532087464437474 (å¾®ç§’æœ€å¤§ç²¾åº¦)
* @example getPreciseTimestamp(6)  1532087464437474
* @example getPreciseTimestamp(5)  153208746443747  (1/100000 ç§’ç²¾åº¦)
* @example getPreciseTimestamp(4)  15320874644375   (1/10000 ç§’ç²¾åº¦)
* @example getPreciseTimestamp(3)  1532087464437    (æ¯«ç§’ precision)
* @example getPreciseTimestamp(2)  153208746444     (1/100 ç§’ç²¾åº¦)
* @example getPreciseTimestamp(1)  15320874644      (1/10 ç§’ç²¾åº¦)
* @example getPreciseTimestamp(0)  1532087464       (ç§’ç²¾åº¦)
* @example getPreciseTimestamp(-1) 153208746        (10 ç§’ç²¾åº¦)
* @example getPreciseTimestamp(-2) 15320875         (100 ç§’ç²¾åº¦)
*/</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>å¦‚æœéœ€è¦åŒæ ·å†…å®¹åœ¨è¡¨ä¸­åªæœ‰ä¸€æ¡æ•°æ®ï¼Œå¯ä»¥ç”¨ <code class="language-plaintext highlighter-rouge">firstOrCreate()</code></p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// æŒ‰åç§°æ£€ç´¢èˆªç­æˆ–åœ¨å®ƒä¸å­˜åœ¨æ—¶åˆ›å»ºå®ƒ...</span>
<span class="nv">$flight</span> <span class="o">=</span> <span class="nc">Flight</span><span class="o">::</span><span class="nf">firstOrCreate</span><span class="p">([</span>
    <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'London to Paris'</span>
<span class="p">]);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>ç‰¹åˆ«æ³¨æ„ï¼šçº¿ä¸Šç¯å¢ƒï¼Œç”¨å®å¡”é¢æ¿åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå¦‚æœæ‰§è¡Œ airtisan å‘½ä»¤å‡ºç°é”™è¯¯ï¼Œæ—¥å¿—æ–‡ä»¶ä¼šç”¨ root çš„èº«ä»½åˆ›å»ºï¼Œå¯¼è‡´è¿è¡Œåœ¨ www çš„ä»£ç æ²¡æœ‰æƒé™è¿›è¡Œè¯»å†™ã€‚</p>
  </li>
</ul>

<h3 id="ä¾èµ–æ³¨å…¥">ä¾èµ–æ³¨å…¥</h3>

<blockquote>
  <p>å½“Aç±»éœ€è¦ä¾èµ–äºBç±»ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦åœ¨Aç±»ä¸­å®ä¾‹åŒ–Bç±»çš„å¯¹è±¡æ¥ä½¿ç”¨æ—¶å€™ï¼Œå¦‚æœBç±»ä¸­çš„åŠŸèƒ½å‘ç”Ÿæ”¹å˜ï¼Œä¹Ÿä¼šå¯¼è‡´Aç±»ä¸­ä½¿ç”¨Bç±»çš„åœ°æ–¹ä¹Ÿè¦è·Ÿç€ä¿®æ”¹ï¼Œå¯¼è‡´Aç±»ä¸Bç±»é«˜è€¦åˆã€‚</p>
</blockquote>

<p>ä¾èµ–æ³¨å…¥æœ¬è´¨æ˜¯åœ¨å¤–éƒ¨å°† B ç±»å®ä¾‹åŒ–åï¼Œå†ä¼ åˆ° A ç±»ï¼Œè¿™æ ·å¯¹ B ç±»çš„ä¿®æ”¹æ‰©å±•ï¼Œä¸ç”¨æ”¹ A çš„ä»£ç ã€‚</p>

<blockquote>
  <p>ä¸éœ€è¦è‡ªå·±å†…å®¹ä¿®æ”¹ï¼Œæ”¹æˆç”±å¤–éƒ¨ä¼ é€’ã€‚è¿™ç§ç”±å¤–éƒ¨è´Ÿè´£å…¶ä¾èµ–éœ€æ±‚çš„è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ç§°å…¶ä¸º â€œæ§åˆ¶åè½¬ï¼ˆIoCï¼‰â€ã€‚</p>

  <p>é‚£ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥å‘¢ï¼Ÿï¼Œå…¶å®ä¸Šé¢çš„ä¾‹å­ä¹Ÿç®—æ˜¯ä¾èµ–æ³¨å…¥ï¼Œä¸æ˜¯ç”±è‡ªå·±å†…éƒ¨ new å¯¹è±¡æˆ–è€…å®ä¾‹ï¼Œé€šè¿‡æ„é€ å‡½æ•°ï¼Œæˆ–è€…æ–¹æ³•ä¼ å…¥çš„éƒ½å±äº ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ ã€‚</p>
</blockquote>

<p><a href="https://learnku.com/docs/laravel-core-concept/5.5/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5,%E6%8E%A7%E5%88%B6%E7%BF%BB%E8%BD%AC,%E5%8F%8D%E5%B0%84/3017">æ›´å¤š</a></p>

<h3 id="æœåŠ¡å®¹å™¨">æœåŠ¡å®¹å™¨</h3>

<p>TODO</p>

<h3 id="laravel-permission">Laravel-Permission</h3>

<h4 id="ç»™è§’è‰²åŒæ­¥æƒé™">ç»™è§’è‰²åŒæ­¥æƒé™</h4>

<p>å‰ç«¯ç”¨ Json ä¼ å…¥éœ€è¦åŒæ­¥çš„å…¨éƒ¨ Idï¼Œé€šè¿‡ whereIn() è¿‡æ»¤æ‰ Id ä¸å­˜åœ¨çš„æƒé™</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">syncPermissions</span><span class="p">(</span><span class="kt">Role</span> <span class="nv">$role</span><span class="p">,</span> <span class="kt">Request</span> <span class="nv">$request</span><span class="p">)</span><span class="c1">// TODO è¡¨å•éªŒè¯</span>
<span class="p">{</span>
    <span class="nv">$permissionIds</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="n">permissionIds</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nv">$permissions</span> <span class="o">=</span> <span class="nc">Permission</span><span class="o">::</span><span class="nf">whereIn</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="nv">$permissionIds</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
        <span class="c1">// å°†å¤šä¸ªæƒé™åŒæ­¥åˆ°ä¸€ä¸ªè§’è‰²</span>
        <span class="nv">$role</span><span class="o">-&gt;</span><span class="nf">syncPermissions</span><span class="p">(</span><span class="nv">$permissions</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="err">\</span><span class="nc">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">\</span><span class="nc">Log</span><span class="o">::</span><span class="nf">channel</span><span class="p">(</span><span class="s1">'errors'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">notice</span><span class="p">(</span><span class="s1">'[è§’è‰²æƒé™]ç»™è§’è‰²('</span><span class="mf">.</span><span class="nv">$role</span><span class="o">-&gt;</span><span class="n">name</span><span class="mf">.</span><span class="s1">')æ·»åŠ æƒé™('</span><span class="mf">.</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="n">permissionIds</span><span class="mf">.</span><span class="s1">')æ—¶å‡ºé”™ï¼Œé”™è¯¯æç¤ºï¼š'</span><span class="mf">.</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="nf">getMessage</span><span class="p">());</span>
        <span class="k">return</span> <span class="nf">response</span><span class="p">([</span>
            <span class="s1">'code'</span> <span class="o">=&gt;</span> <span class="mi">500</span><span class="p">,</span>
            <span class="s1">'messages'</span> <span class="o">=&gt;</span> <span class="s1">'æ·»åŠ å¤±è´¥'</span><span class="p">,</span>
            <span class="s1">'data'</span> <span class="o">=&gt;</span> <span class="p">[]</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nf">response</span><span class="p">([</span>
        <span class="s1">'code'</span> <span class="o">=&gt;</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s1">'messages'</span> <span class="o">=&gt;</span> <span class="s1">'è§’è‰²æ·»åŠ æƒé™æˆåŠŸ'</span><span class="p">,</span>
        <span class="s1">'data'</span> <span class="o">=&gt;</span> <span class="p">[]</span>
    <span class="p">]);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="çˆ¬è™«ç›¸å…³">çˆ¬è™«ç›¸å…³</h3>

<h4 id="http2">HTTP/2</h4>

<h5 id="ç‰¹å¾">ç‰¹å¾</h5>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">:authority: pc.api.longyiyy.com 
:method: GET
:path: /api/goods/list?page=1&amp;category_id=&amp;sort=&amp;order=&amp;is_activity=0&amp;is_youx=&amp;is_xy=&amp;no_image=0
:scheme: https
accept: application/json, text/plain, */*
</span></code></pre></div></div>

<p>HTTP/2 æœ€æ˜æ˜¾çš„ç‰¹å¾å°±æ˜¯ä»æµè§ˆå™¨ Header å¤´é‡Œé¢å¯ä»¥çœ‹åˆ° <code class="language-plaintext highlighter-rouge">:</code>å¼€å¤´çš„ä¼ª Header å¤´ï¼Œç”¨ PHP Guzzle è¯·æ±‚çš„æ—¶å€™ï¼Œä¸éœ€è¦åœ¨ Header å¤´é‡Œé¢åŠ å…¥ä¼ª Header å¤´ï¼Œåªéœ€è¦åœ¨è¯·æ±‚é€‰é¡¹ä¸­ï¼Œè®¾å®šä½¿ç”¨ HTTP/2 åè®®ã€‚</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$response</span> <span class="o">=</span> <span class="nc">Http</span><span class="o">::</span><span class="nf">withHeaders</span><span class="p">([</span>
			<span class="s1">'accept'</span> <span class="o">=&gt;</span> <span class="s1">'application/json, text/plain, */*'</span><span class="p">,</span>
            <span class="s1">'accept-encoding'</span> <span class="o">=&gt;</span> <span class="s1">'gzip, deflate, br'</span><span class="p">,</span>
            <span class="s1">'accept-language'</span> <span class="o">=&gt;</span> <span class="s1">'zh-CN,zh;q=0.9'</span><span class="p">,</span>
            <span class="s1">'cookie'</span> <span class="o">=&gt;</span> <span class="s1">'...'</span><span class="p">,</span>
            <span class="s1">'origin'</span> <span class="o">=&gt;</span> <span class="s1">'...'</span><span class="p">,</span>
            <span class="s1">'sec-ch-ua'</span> <span class="o">=&gt;</span> <span class="s1">'...'</span><span class="p">,</span>
            <span class="s1">'sec-ch-ua-mobile'</span> <span class="o">=&gt;</span> <span class="s1">'...'</span><span class="p">,</span>
            <span class="s1">'sec-ch-ua-platform'</span> <span class="o">=&gt;</span> <span class="s1">'...'</span><span class="p">,</span>
            <span class="s1">'sec-fetch-dest'</span> <span class="o">=&gt;</span> <span class="s1">'...'</span><span class="p">,</span>
            <span class="s1">'sec-fetch-mode'</span> <span class="o">=&gt;</span> <span class="s1">'...'</span><span class="p">,</span>
            <span class="s1">'sec-fetch-site'</span> <span class="o">=&gt;</span> <span class="s1">'...'</span><span class="p">,</span>
            <span class="s1">'user-agent'</span> <span class="o">=&gt;</span> <span class="s1">'...'</span>
		<span class="p">])</span><span class="o">-&gt;</span><span class="nf">withOptions</span><span class="p">([</span>
            <span class="s1">'version'</span> <span class="o">=&gt;</span> <span class="mf">2.0</span><span class="p">,</span>
		<span class="p">])</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="p">[</span><span class="mf">...</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="excel">Excel</h3>

<h4 id="å¯¼å‡º-excel">å¯¼å‡º Excel</h4>

<h5 id="laravel-excel"><a href="https://docs.laravel-excel.com/3.1/getting-started/">Laravel Excel</a></h5>

<p>å®‰è£…æ‰©å±•åŒ…</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer require maatwebsite/excel
</code></pre></div></div>

<p>åˆ›å»ºè¾“å‡ºç±»</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:export ExampleExport <span class="nt">--model</span><span class="o">=</span>Example
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">app/Exports/ExampleExport.php</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Exports</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">App\Models\Example</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Maatwebsite\Excel\Concerns\FromCollection</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Maatwebsite\Excel\Concerns\WithColumnWidths</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Maatwebsite\Excel\Concerns\WithHeadings</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Maatwebsite\Excel\Concerns\WithMapping</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ProductsExport</span> <span class="kd">implements</span> <span class="nc">FromCollection</span><span class="p">,</span> <span class="nc">WithColumnWidths</span><span class="p">,</span> <span class="nc">WithHeadings</span><span class="p">,</span> <span class="nc">WithMapping</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">collection</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="mf">...</span>
        <span class="c1">// è·å–æ•°æ®</span>
        <span class="mf">...</span>
        <span class="k">return</span> <span class="nv">$collections</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// æŒ‡å®šåˆ—çš„å®½åº¦ï¼Œå•ä½ä¸æ˜¯åƒç´ </span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">columnWidths</span><span class="p">():</span> <span class="kt">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">'A'</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s1">'B'</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
            <span class="mf">...</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// æŒ‡å®šæ¯ä¸€åˆ—å¯¹åº”çš„æ•°æ®æº</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">map</span><span class="p">(</span><span class="nv">$row</span><span class="p">):</span> <span class="kt">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="nv">$row</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">''</span><span class="p">,</span>
            <span class="nv">$row</span><span class="o">-&gt;</span><span class="n">licenseNumber</span><span class="p">,</span>
            <span class="mf">...</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// æ ‡é¢˜</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">headings</span><span class="p">():</span> <span class="kt">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">'å•†å“ç¼–å·'</span><span class="p">,</span>
            <span class="s1">'å•†å“æ¡ç '</span><span class="p">,</span>
            <span class="mf">...</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>å¯¼å‡ºåˆ°ç£ç›˜</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Excel</span><span class="o">::</span><span class="nf">store</span><span class="p">(</span><span class="k">new</span> <span class="nc">ExampleExport</span><span class="p">(),</span> <span class="s1">'examples_'</span><span class="mf">.</span><span class="nf">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">timestamp</span><span class="mf">.</span><span class="s1">'.xlsx'</span><span class="p">);</span>
</code></pre></div></div>

<p>æ§åˆ¶å™¨ä¸­å¯¼å‡ºä¸‹è½½</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="nc">Excel</span><span class="o">::</span><span class="nf">download</span><span class="p">(</span><span class="k">new</span> <span class="nc">ExampleExport</span><span class="p">,</span> <span class="s1">'examples.xlsx'</span><span class="p">);</span>
</code></pre></div></div>

<p><a href="https://docs.laravel-excel.com/3.1/exports/">æ›´å¤šå¯¼å‡ºè¯¦æƒ…</a></p>

:ET