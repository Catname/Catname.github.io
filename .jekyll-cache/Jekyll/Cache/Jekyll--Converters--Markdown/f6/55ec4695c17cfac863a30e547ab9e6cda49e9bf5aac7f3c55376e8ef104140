I"…«<h1 id="evabbs">EvaBBS</h1>
<hr />
<h2 id="git-å·¥ä½œæµ">Git å·¥ä½œæµ</h2>
<h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git init
git add <span class="nt">-A</span>
git commit <span class="nt">-m</span> <span class="s1">'reason'</span>
git remote add origin git@github.com:&lt;username&gt;/é¡¹ç›®å.git
git push <span class="nt">-u</span> origin é»˜è®¤åˆ†æ”¯å
</code></pre></div></div>

<h3 id="æ—¥å¸¸">æ—¥å¸¸</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout <span class="nb">.</span> ï¼ˆæ”¾å¼ƒæ“ä½œï¼‰
git checkout <span class="nt">-b</span> åˆ†æ”¯å
git add <span class="nt">-A</span> æˆ– git add filename
git commit <span class="nt">-m</span> <span class="s1">'reason'</span>
git push
</code></pre></div></div>

<hr />
<h2 id="å‰ç«¯å·¥ä½œæµ">å‰ç«¯å·¥ä½œæµ</h2>
<h3 id="é›†æˆ-bootstrap">é›†æˆ Bootstrap</h3>
<ul>
  <li>Composer å®‰è£…ç›¸åº”çš„æ–‡ä»¶</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer require laravel/ui:^2.0 <span class="nt">--dev</span>

php artisan ui bootstrap

yarn <span class="nb">install

</span>npm run watch-poll ï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶ç¼–è¯‘ï¼‰ æˆ– npm run dev ï¼ˆç¼–è¯‘ä¸€æ¬¡ï¼‰
</code></pre></div></div>

<h3 id="ä¿®æ”¹æ ·å¼">ä¿®æ”¹æ ·å¼</h3>
<p>ä¿®æ”¹ <code class="language-plaintext highlighter-rouge">resources/sass/app.scss</code> åï¼Œè¿è¡Œï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm run watch-poll ï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶ç¼–è¯‘ï¼‰ æˆ– npm run dev ï¼ˆç¼–è¯‘ä¸€æ¬¡ï¼‰
</code></pre></div></div>

<h3 id="é˜²æ­¢æµè§ˆå™¨ç¼“å­˜é—®é¢˜">é˜²æ­¢æµè§ˆå™¨ç¼“å­˜é—®é¢˜</h3>
<p>ä¿®æ”¹ <code class="language-plaintext highlighter-rouge">webpack.mix.js</code></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mix</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">laravel-mix</span><span class="dl">'</span><span class="p">);</span>
 <span class="nx">mix</span><span class="p">.</span><span class="nx">js</span><span class="p">(</span><span class="dl">'</span><span class="s1">resources/js/app.js</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">public/js</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">sass</span><span class="p">(</span><span class="dl">'</span><span class="s1">resources/sass/app.scss</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">public/css</span><span class="dl">'</span><span class="p">).</span><span class="nx">version</span><span class="p">();</span>
</code></pre></div></div>

<p>ä¿®æ”¹ <code class="language-plaintext highlighter-rouge">resources/views/layouts/app.blade.php</code></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- Styles --&gt;</span>

<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"{{ mix('css/app.css'}}"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>

</code></pre></div></div>

<h3 id="å­—ä½“å›¾æ ‡">å­—ä½“å›¾æ ‡</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yarn add @fortawesome/fontawesome-free
</code></pre></div></div>

<p>åœ¨æ ·å¼ä¸­è½½å…¥ <code class="language-plaintext highlighter-rouge">resources/sass/app.scss</code></p>

<div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Fontawesome</span>
<span class="k">@import</span> <span class="s1">'~@fortawesome/fontawesome-free/scss/fontawesome'</span><span class="p">;</span>
<span class="k">@import</span> <span class="s1">'~@fortawesome/fontawesome-free/scss/regular'</span><span class="p">;</span>
<span class="k">@import</span> <span class="s1">'~@fortawesome/fontawesome-free/scss/solid'</span><span class="p">;</span>
<span class="k">@import</span> <span class="s1">'~@fortawesome/fontawesome-free/scss/brands'</span><span class="p">;</span>
</code></pre></div></div>

<p>ç„¶åç¼–è¯‘</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm run watch-poll ï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶ç¼–è¯‘ï¼‰ æˆ– npm run dev ï¼ˆç¼–è¯‘ä¸€æ¬¡ï¼‰
</code></pre></div></div>

<hr />
<h2 id="ç”¨æˆ·è®¤è¯">ç”¨æˆ·è®¤è¯</h2>
<h3 id="laravel-è‡ªå¸¦çš„ç”¨æˆ·è®¤è¯è„šæ‰‹æ¶">Laravel è‡ªå¸¦çš„ç”¨æˆ·è®¤è¯è„šæ‰‹æ¶</h3>
<p>æ‰§è¡Œè®¤è¯è„šæ‰‹æ¶å‘½ä»¤ï¼Œç”Ÿæˆä»£ç ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan ui:auth
</code></pre></div></div>

<p>å®ƒä¼šè‡ªåŠ¨ç”Ÿæˆç”¨æˆ·è®¤è¯è·¯ç”±ï¼š</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Auth</span><span class="o">::</span><span class="nf">routes</span><span class="p">();</span>
</code></pre></div></div>

<p>åŒæ—¶ <code class="language-plaintext highlighter-rouge">ui:auth</code> å‘½ä»¤ç”Ÿæˆäº† <code class="language-plaintext highlighter-rouge">resources/views/auth</code> ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š</p>

<table>
  <thead>
    <tr>
      <th>è§†å›¾åç§°</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>register.blade.php</td>
      <td>æ³¨å†Œé¡µé¢è§†å›¾</td>
    </tr>
    <tr>
      <td>login.blade.php</td>
      <td>ç™»å½•é¡µé¢è§†å›¾</td>
    </tr>
    <tr>
      <td>verify.blade.php</td>
      <td>é‚®ç®±è®¤è¯è§†å›¾</td>
    </tr>
    <tr>
      <td>passwords/email.blade.php</td>
      <td>æäº¤é‚®ç®±å‘é€é‚®ä»¶çš„è§†å›¾</td>
    </tr>
    <tr>
      <td>passwords/reset.blade.php</td>
      <td>é‡ç½®å¯†ç çš„é¡µé¢è§†å›¾</td>
    </tr>
  </tbody>
</table>

<h3 id="æœ¬åœ°åŒ–">æœ¬åœ°åŒ–</h3>
<p>å®‰è£…è¯­è¨€åŒ… Laravel Langï¼Œæ­¤é¡¹ç›®æ”¯æŒäº†52ä¸ªå›½å®¶çš„è¯­è¨€</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer require <span class="s2">"overtrue/laravel-lang:~3.0"</span>
</code></pre></div></div>

<p>å°† <code class="language-plaintext highlighter-rouge">config/app.php</code> ä¸­çš„ä¸‹ä¸€è¡Œ</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Illuminate\Translation\TranslationServiceProvider</span><span class="o">::</span><span class="n">class</span><span class="p">,</span>
</code></pre></div></div>

<p>æ›¿æ¢ä¸ºï¼š</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Overtrue\LaravelLang\TranslationServiceProvider</span><span class="o">::</span><span class="n">class</span><span class="p">,</span>
</code></pre></div></div>

<h3 id="blade-æ¨¡ç‰ˆä¸­åˆ¤æ–­ç™»å½•çŠ¶æ€">Blade æ¨¡ç‰ˆä¸­åˆ¤æ–­ç™»å½•çŠ¶æ€</h3>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@guest
    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{{ route('login') }}"</span><span class="nt">&gt;</span>ç™»å½•<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{{ route('register') }}"</span><span class="nt">&gt;</span>æ³¨å†Œ<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
@else
    ...
@endguest
</code></pre></div></div>

<h3 id="éªŒè¯ç ">éªŒè¯ç </h3>
<h4 id="å®‰è£…ç¬¬ä¸‰æ–¹æ‰©å±•åŒ…-mewscaptcha-ä½œä¸ºåŸºç¡€æ¥å®ç°éªŒè¯ç åŠŸèƒ½">å®‰è£…ç¬¬ä¸‰æ–¹æ‰©å±•åŒ… mews/captcha ä½œä¸ºåŸºç¡€æ¥å®ç°éªŒè¯ç åŠŸèƒ½ã€‚</h4>
<p>ç»ˆç«¯ä¸­æ‰§è¡Œï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer require <span class="s2">"mews/captcha:~3.0"</span>

php artisan vendor:publish <span class="nt">--provider</span><span class="o">=</span><span class="s1">'Mews\Captcha\CaptchaServiceProvider'</span> 
</code></pre></div></div>

<h4 id="é¡µé¢åµŒå…¥">é¡µé¢åµŒå…¥</h4>
<h5 id="å‰ç«¯å±•ç¤º">å‰ç«¯å±•ç¤º</h5>
<p>ç»ˆç«¯ä¸­æ‰§è¡Œï¼š</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"thumbnail captcha mt-3 mb-2"</span> 
     <span class="na">src=</span><span class="s">"{{ captcha_src('flat') }}"</span> 
     <span class="na">onclick=</span><span class="s">"this.src='/captcha/flat?'+Math.random()"</span> 
     <span class="na">title=</span><span class="s">"ç‚¹å‡»å›¾ç‰‡é‡æ–°è·å–éªŒè¯ç "</span><span class="nt">&gt;</span>
</code></pre></div></div>

<h5 id="åç«¯éªŒè¯">åç«¯éªŒè¯</h5>
<p>å®ç°åŸç†ï¼šåˆ©ç”¨äº†Laravel è¡¨å•éªŒè¯å™¨æä¾›çš„ <a href="https://learnku.com/docs/laravel/7.x/validation/7467#custom-validation-rules">è‡ªå®šä¹‰è¡¨å•éªŒè¯è§„åˆ™</a> åŠŸèƒ½</p>

<p>åœ¨æ³¨å†Œæ§åˆ¶å™¨ä¸­æ·»åŠ ä¸Šè¡¨å•éªŒè¯è§„åˆ™
<code class="language-plaintext highlighter-rouge">app/Http/Controllers/Auth/RegisterController.php</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="k">function</span> <span class="n">validator</span><span class="p">(</span><span class="kt">array</span> <span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nc">Validator</span><span class="o">::</span><span class="nf">make</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="p">[</span>
            <span class="mf">...</span>
            <span class="s1">'captcha'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'required'</span><span class="p">,</span> <span class="s1">'captcha'</span><span class="p">],</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="s1">'captcha.required'</span> <span class="o">=&gt;</span> <span class="s1">'éªŒè¯ç ä¸èƒ½ä¸ºç©º'</span><span class="p">,</span>
            <span class="s1">'captcha.captcha'</span> <span class="o">=&gt;</span> <span class="s1">'è¯·è¾“å…¥æ­£ç¡®çš„éªŒè¯ç '</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>
</code></pre></div></div>

<h3 id="é‚®ç®±è®¤è¯">é‚®ç®±è®¤è¯</h3>
<h4 id="é‚®ç®±è®¤è¯å·¥ä½œæœºåˆ¶ä¸€èˆ¬åˆ†ä¸¤æ­¥">ã€é‚®ç®±è®¤è¯ã€å·¥ä½œæœºåˆ¶ä¸€èˆ¬åˆ†ä¸¤æ­¥</h4>
<ol>
  <li>å‘é€è®¤è¯é‚®ä»¶ â€”â€” å°†é™„å¸¦è®¤è¯ä¿¡æ¯çš„ã€è®¤è¯é“¾æ¥ã€å‘é€åˆ°ç”¨æˆ·é‚®ç®±é‡Œï¼›</li>
  <li>æ£€æµ‹è®¤è¯é“¾æ¥ â€”â€” ç”¨æˆ·æ‰“å¼€é‚®ä»¶ï¼Œç‚¹å‡»è®¤è¯é“¾æ¥è¿›å…¥ç½‘ç«™ï¼Œç¨‹åºæ£€æµ‹ URL ä¸­è®¤è¯å‚æ•°çš„åˆæ³•æ€§ï¼Œå¹¶æ¸²æŸ“å¯¹åº”çš„é¡µé¢ã€‚
    <h4 id="è®¤è¯è¿‡ç¨‹æ€è·¯">è®¤è¯è¿‡ç¨‹æ€è·¯</h4>
  </li>
  <li>ç”¨æˆ·æ³¨å†ŒæˆåŠŸåï¼Œç»™ç”¨æˆ·å‘é€ä¸€ä¸ªè®¤è¯é‚®ä»¶ï¼›</li>
  <li>ç”¨æˆ·ç™»å½•çŠ¶æ€ä¸‹ï¼Œå¦‚é‚®ç®±æœªè®¤è¯ï¼Œé‡å®šå‘åˆ°æé†’éªŒè¯é‚®ç®±çš„é¡µé¢ä¸­ã€‚
    <h4 id="å®ç°åŸç†">å®ç°åŸç†</h4>
    <ul>
      <li>ä½¿ç”¨ Laravel é»˜è®¤è‡ªå¸¦<strong>é‚®ç®±è®¤è¯</strong>åŠŸèƒ½</li>
      <li>ç”¨æˆ·åœ¨æäº¤æ³¨å†Œè¡¨å•åï¼ŒLaravel ä¼šé€šè¿‡äº‹ä»¶ç³»ç»Ÿè§¦å‘ Registered äº‹ä»¶ï¼Œé€šè¿‡ç›‘å¬æ­¤äº‹ä»¶ï¼Œåœ¨è§¦å‘æ—¶å‘é€ç”¨æˆ·è®¤è¯é‚®ä»¶ã€‚</li>
      <li>ä½¿ç”¨è‡ªå®šä¹‰ä¸­é—´ä»¶è¿‡æ»¤ç”¨æˆ·æ‰€æœ‰è¯·æ±‚ï¼Œå°†æœªè®¤è¯ç”¨æˆ·å¼ºåˆ¶è·³è½¬åˆ°è®¤è¯æç¤ºé¡µé¢ã€‚</li>
    </ul>
  </li>
</ol>

<hr />
<h2 id="ç”¨æˆ·æˆæƒ">ç”¨æˆ·æˆæƒ</h2>
<h3 id="é™åˆ¶æ¸¸å®¢è®¿é—®">é™åˆ¶æ¸¸å®¢è®¿é—®</h3>
<h4 id="auth-ä¸­é—´ä»¶">Auth ä¸­é—´ä»¶</h4>
<p>é™¤äº† show ï¼Œå…¶ä»–éƒ½éœ€è¦ç™»å½•åæ‰èƒ½è®¿é—®</p>

<p><code class="language-plaintext highlighter-rouge">UsersController.php</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">middleware</span><span class="p">(</span><span class="s1">'auth'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'except'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'show'</span><span class="p">]]);</span>
    <span class="p">}</span>
</code></pre></div></div>

<h3 id="åªèƒ½ç¼–è¾‘è‡ªå·±çš„èµ„æ–™">åªèƒ½ç¼–è¾‘è‡ªå·±çš„èµ„æ–™</h3>
<h4 id="policy-æˆæƒç­–ç•¥ç±»">Policy æˆæƒç­–ç•¥ç±»</h4>
<p>ç»ˆç«¯ä¸­æ‰§è¡Œï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:policy UserPolicy
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">app/Policies/UserPolicy.php</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">update</span><span class="p">(</span><span class="kt">User</span> <span class="nv">$currentUser</span><span class="p">,</span> <span class="kt">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$currentUser</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">===</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>åœ¨éœ€è¦æˆæƒçš„åœ°æ–¹ä½¿ç”¨</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">authorize</span><span class="p">(</span><span class="s1">'update'</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="blade-æ¨¡ç‰ˆæ ¹æ®æƒé™æ˜¾ç¤ºå†…å®¹">Blade æ¨¡ç‰ˆæ ¹æ®æƒé™æ˜¾ç¤ºå†…å®¹</h3>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@can('update', $topic)
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"operate"</span><span class="nt">&gt;</span>
       ...
    <span class="nt">&lt;/div&gt;</span>
@endcan
</code></pre></div></div>

<hr />
<h2 id="è¡¨å•éªŒè¯">è¡¨å•éªŒè¯</h2>
<h3 id="è¡¨å•è¯·æ±‚éªŒè¯-formrequest"><a href="https://learnku.com/docs/laravel/7.x/validation/7467">è¡¨å•è¯·æ±‚éªŒè¯</a> ï¼ˆFormRequestï¼‰</h3>
<p>ç”¨æ¥éªŒè¯ç”¨æˆ·æäº¤çš„æ•°æ®æ˜¯å¦åˆè§„</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:request UserRequest
</code></pre></div></div>

<p>å¸¸ç”¨éªŒè¯è§„åˆ™<br />
<a href="https://learnku.com/docs/laravel/7.x/validation/7467#rule-alpha-dash">alpha_dash</a> :éªŒè¯å­—æ®µå¯èƒ½åŒ…å«å­—æ¯ã€æ•°å­—ï¼Œä»¥åŠç ´æŠ˜å· (-) å’Œä¸‹åˆ’çº¿ ( _ )ã€‚<br />
<a href="https://learnku.com/docs/laravel/7.x/validation/7467#rule-between">between:min,max</a> :éªŒè¯å­—æ®µçš„å¤§å°å¿…é¡»åœ¨ç»™å®šçš„ <code class="language-plaintext highlighter-rouge">min</code> å’Œ <code class="language-plaintext highlighter-rouge">max</code> ä¹‹é—´ã€‚å­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„å’Œæ–‡ä»¶çš„è®¡ç®—æ–¹å¼éƒ½ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">size</code> æ–¹æ³•ã€‚<br />
<a href="https://learnku.com/docs/laravel/7.x/validation/7467#rule-confirmed">confirmed</a> :éªŒè¯å­—æ®µå¿…é¡»å…·æœ‰åŒ¹é…å­—æ®µ <code class="language-plaintext highlighter-rouge">foo_confirmation</code> ã€‚ä¾‹å¦‚ï¼ŒéªŒè¯å­—æ®µä¸º <code class="language-plaintext highlighter-rouge">password</code> ï¼Œè¾“å…¥ä¸­å¿…é¡»å­˜åœ¨ä¸ä¹‹åŒ¹é…çš„ <code class="language-plaintext highlighter-rouge">password_confirmation</code> å­—æ®µã€‚<br />
<a href="https://learnku.com/docs/laravel/7.x/validation/7467#rule-email">email</a> :éªŒè¯çš„å­—æ®µå¿…é¡»ç¬¦åˆ <code class="language-plaintext highlighter-rouge">e-mail</code> åœ°å€æ ¼å¼ã€‚<br />
<a href="https://learnku.com/docs/laravel/7.x/validation/7467#rule-nullable">nullable</a> :éªŒè¯å­—æ®µå¯ä»¥ä¸º <code class="language-plaintext highlighter-rouge">null</code>ã€‚è¿™åœ¨éªŒè¯åŸºæœ¬æ•°æ®ç±»å‹æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œä¾‹å¦‚å¯ä»¥åŒ…å«ç©ºå€¼çš„å­—ç¬¦ä¸²å’Œæ•´æ•°ã€‚<br />
<a href="https://learnku.com/docs/laravel/7.x/validation/7467#rule-required">required</a> :éªŒè¯çš„å­—æ®µå¿…é¡»å­˜åœ¨äºè¾“å…¥æ•°æ®ä¸­ï¼Œè€Œä¸æ˜¯ç©ºã€‚<br />
<a href="https://learnku.com/docs/laravel/7.x/validation/7467#rule-unique">unique:table,column,except,idColumn</a> :éªŒè¯å­—æ®µåœ¨ç»™å®šçš„æ•°æ®åº“è¡¨ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚</p>

<hr />
<h2 id="å›¾ç‰‡ä¸Šä¼ ">å›¾ç‰‡ä¸Šä¼ </h2>
<h3 id="é€šè¿‡-è¯·æ±‚å¯¹è±¡-requestæ¥è·å–">é€šè¿‡ <a href="https://learnku.com/docs/laravel/7.x/requests#retrieving-uploaded-files">è¯·æ±‚å¯¹è±¡</a> ï¼ˆRequestï¼‰æ¥è·å–</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$file</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">avatar</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="é€šè¿‡-è¡¨å•è¯·æ±‚éªŒè¯-formrequesté™åˆ¶å›¾ç‰‡å¤§å°">é€šè¿‡ <a href="https://learnku.com/docs/laravel/7.x/validation/7467">è¡¨å•è¯·æ±‚éªŒè¯</a> ï¼ˆFormRequestï¼‰é™åˆ¶å›¾ç‰‡å¤§å°</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="p">[</span>
           <span class="s1">'avatar'</span> <span class="o">=&gt;</span> <span class="s1">'mimes:jpeg,bmp,png,gif|dimensions:min_width=208,min_height=208'</span><span class="p">,</span>
       <span class="p">];</span>
</code></pre></div></div>

<h3 id="è£å‰ªå›¾åƒ">è£å‰ªå›¾åƒ</h3>
<p>å›¾ç‰‡å¤ªå¤§ä¼šæ‹–æ…¢é¡µé¢çš„åŠ è½½é€Ÿåº¦ã€‚<br />
é€šè¿‡ Intervention/image æ‰©å±•åŒ…æ¥å¤„ç†å›¾ç‰‡è£åˆ‡çš„é€»è¾‘</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer require intervention/image

php artisan vendor:publish <span class="nt">--provider</span><span class="o">=</span><span class="s2">"Intervention</span><span class="se">\I</span><span class="s2">mage</span><span class="se">\I</span><span class="s2">mageServiceProviderLaravelRecent"</span>
</code></pre></div></div>

<hr />
<h2 id="è°ƒè¯•ç”¨çš„å‡æ•°æ®å¡«å……">è°ƒè¯•ç”¨çš„å‡æ•°æ®å¡«å……</h2>
<h3 id="ä»¥ç”¨æˆ·æ•°æ®ä¸ºä¾‹æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶">ä»¥ç”¨æˆ·æ•°æ®ä¸ºä¾‹ï¼Œæ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š</h3>
<ol>
  <li>æ•°æ®æ¨¡å‹ User.php</li>
  <li>ç”¨æˆ·çš„æ•°æ®å·¥å‚ database/factories/UserFactory.php</li>
  <li>ç”¨æˆ·çš„æ•°æ®å¡«å…… database/seeds/UsersTableSeeder.php</li>
  <li>æ³¨å†Œæ•°æ®å¡«å…… database/seeds/DatabaseSeeder.php</li>
</ol>

<h3 id="æ­¥éª¤">æ­¥éª¤</h3>
<ol>
  <li>
    <p>å®šåˆ¶ç”¨æˆ·æ•°æ®å·¥å‚ï¼ˆå•ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼‰</p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$factory</span><span class="o">-&gt;</span><span class="nb">define</span><span class="p">(</span><span class="nc">User</span><span class="o">::</span><span class="n">class</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Faker</span> <span class="nv">$faker</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span> <span class="p">[</span>
         <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span>
         <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="nf">unique</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">safeEmail</span><span class="p">,</span>
         <span class="s1">'email_verified_at'</span> <span class="o">=&gt;</span> <span class="nf">now</span><span class="p">(),</span>
         <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi'</span><span class="p">,</span> <span class="c1">// password</span>
         <span class="s1">'remember_token'</span> <span class="o">=&gt;</span> <span class="nc">Str</span><span class="o">::</span><span class="nf">random</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
     <span class="p">];</span>
 <span class="p">});</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>å®Œæˆæ•°æ®å¡«å……æ–‡ä»¶ï¼ˆéœ€è¦å¡«å……å¤šå°‘ï¼‰</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> php artisan make:seed UsersTableSeeder
</code></pre></div>    </div>

    <p>ä¿®æ”¹ <code class="language-plaintext highlighter-rouge">database/seeds/UsersTableSeeder.php</code></p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">public</span> <span class="k">function</span> <span class="n">run</span><span class="p">()</span>
 <span class="p">{</span>
     <span class="c1">// ç”Ÿæˆæ•°æ®é›†åˆ</span>
     <span class="nv">$users</span> <span class="o">=</span> <span class="nf">factory</span><span class="p">(</span><span class="nc">User</span><span class="o">::</span><span class="n">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">times</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">create</span><span class="p">();</span>

     <span class="c1">// å•ç‹¬å¤„ç†ç¬¬ä¸€ä¸ªç”¨æˆ·çš„æ•°æ®</span>
     <span class="nv">$user</span> <span class="o">=</span> <span class="nc">User</span><span class="o">::</span><span class="nf">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
     <span class="nv">$user</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'tomcat'</span><span class="p">;</span>
     <span class="nv">$user</span><span class="o">-&gt;</span><span class="n">email</span> <span class="o">=</span> <span class="s1">'tomcath@foxmail.com'</span><span class="p">;</span>
     <span class="nv">$user</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>æ³¨å†Œæ•°æ®å¡«å…… <code class="language-plaintext highlighter-rouge">database/seeds/DatabaseSeeder.php</code></p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">public</span> <span class="k">function</span> <span class="n">run</span><span class="p">()</span>
 <span class="p">{</span>
     <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">call</span><span class="p">(</span><span class="nc">UsersTableSeeder</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>é‡ç½®æ•°æ®åº“å¹¶å¡«å……æ•°æ®</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> php artisan migrate:refresh <span class="nt">--seed</span>
</code></pre></div>    </div>
  </li>
</ol>

<hr />
<h2 id="æ¨¡å‹å…³è”">æ¨¡å‹å…³è”</h2>
<h3 id="ä¸€å¯¹ä¸€-hasone">ä¸€å¯¹ä¸€ hasOne</h3>
<h3 id="ä¸€å¯¹ä¸€åå‘å…³è”-belongsto">ä¸€å¯¹ä¸€ï¼ˆåå‘å…³è”ï¼‰ belongsTo</h3>
<ul>
  <li>ä¸€ä¸ª Topic å±äºä¸€ä¸ªåˆ†ç±»ã€‚</li>
  <li>ä¸€ä¸ª Topic å±äºä¸€ä¸ªä½œè€…ã€‚</li>
</ul>

<h3 id="ä¸€å¯¹å¤š-hasmany">ä¸€å¯¹å¤š hasMany</h3>
<ul>
  <li>ä¸€ä¸ªç”¨æˆ·æ‹¥æœ‰å¤šä¸ª Topicã€‚</li>
  <li>ä¸€ä¸ªç”¨æˆ·æ‹¥æœ‰å¤šæ¡ è¯„è®ºã€‚</li>
</ul>

<h3 id="å¤šå¯¹å¤š-belongstomany">å¤šå¯¹å¤š belongsToMany</h3>

<hr />
<h2 id="æ€§èƒ½ä¼˜åŒ–">æ€§èƒ½ä¼˜åŒ–</h2>
<h3 id="å®‰è£…-laravel-å¼€å‘è€…å·¥å…·ç±»---laravel-debugbar">å®‰è£… Laravel å¼€å‘è€…å·¥å…·ç±» - laravel-debugbar</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer require <span class="s2">"barryvdh/laravel-debugbar:~3.2"</span> <span class="nt">--dev</span>

php artisan vendor:publish <span class="nt">--provider</span><span class="o">=</span><span class="s2">"Barryvdh</span><span class="se">\D</span><span class="s2">ebugbar</span><span class="se">\S</span><span class="s2">erviceProvider"</span>
</code></pre></div></div>

<p>æ‰“å¼€ <code class="language-plaintext highlighter-rouge">config/debugbar.php</code>ï¼Œå°† <code class="language-plaintext highlighter-rouge">enabled</code> çš„å€¼è®¾ä¸ºï¼š</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">'enabled'</span> <span class="o">=&gt;</span> <span class="nf">env</span><span class="p">(</span><span class="s1">'APP_DEBUG'</span><span class="p">,</span> <span class="kc">false</span><span class="p">),</span>
</code></pre></div></div>

<h3 id="n1-é—®é¢˜">N+1 é—®é¢˜</h3>
<h4 id="äº§ç”ŸåŸå› ">äº§ç”ŸåŸå› ï¼š</h4>
<p>éå† ORM å…³è”æ•°æ®æ—¶ï¼Œæ¯æ¬¡å¾ªç¯éƒ½è¦å‘æ•°æ®åº“æŸ¥è¯¢å…³è”æ•°æ®ï¼Œè¯» 30 æ¡å°±è¦æ‰§è¡Œ 30 * 2 + 1 = 61 æ¡è¯­å¥ï¼Œæ‰€ä»¥ç§°ä¸º N+1 é—®é¢˜ã€‚</p>
<h4 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆï¼š</h4>
<p>é€šè¿‡ Eloquent æä¾›çš„ <a href="https://learnku.com/docs/laravel/7.x/eloquent-relationships/7500#eager-loading">é¢„åŠ è½½åŠŸèƒ½</a> æ¥è§£å†³æ­¤é—®é¢˜ï¼š</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$topics</span> <span class="o">=</span> <span class="nc">Topic</span><span class="o">::</span><span class="nf">with</span><span class="p">(</span><span class="s1">'user'</span><span class="p">,</span> <span class="s1">'category'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">paginate</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>with() æ–¹æ³•æå‰åŠ è½½äº†æˆ‘ä»¬åé¢éœ€è¦ç”¨åˆ°çš„å…³è”å±æ€§ user å’Œ categoryï¼Œå¹¶åšäº†ç¼“å­˜ã€‚</li>
  <li>åé¢å³ä½¿æ˜¯åœ¨éå†æ•°æ®æ—¶ä½¿ç”¨åˆ°è¿™ä¸¤ä¸ªå…³è”å±æ€§ï¼Œæ•°æ®å·²ç»è¢«é¢„åŠ è½½å¹¶ç¼“å­˜ï¼Œå› æ­¤ä¸ä¼šå†äº§ç”Ÿå¤šä½™çš„ SQL æŸ¥è¯¢ã€‚</li>
</ul>

<hr />
<h2 id="å®‰å…¨æ¼æ´">å®‰å…¨æ¼æ´</h2>
<p>å®‰å…¨åŸåˆ™ <code class="language-plaintext highlighter-rouge">æ°¸è¿œä¸è¦ä¿¡ä»»ç”¨æˆ·æäº¤çš„æ•°æ®ã€‚</code></p>
<h3 id="xss--cross-site-scripting--è·¨ç«™è„šæœ¬æ”»å‡»">XSS ( Cross Site Scripting ) è·¨ç«™è„šæœ¬æ”»å‡»</h3>
<h4 id="æ”»å‡»è€…åœ¨-web-é¡µé¢æ’å…¥-javascript-ä»£ç å½“ç”¨æˆ·æµè§ˆè¯¥é¡µæ—¶ä»£ç ä¾¿ä¼šæ‰§è¡Œå¸¸è§æ“ä½œæ˜¯ç›—å–ç”¨æˆ·-cookie">æ”»å‡»è€…åœ¨ Web é¡µé¢æ’å…¥ JavaScript ä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µæ—¶ï¼Œä»£ç ä¾¿ä¼šæ‰§è¡Œï¼Œå¸¸è§æ“ä½œæ˜¯ç›—å–ç”¨æˆ· Cookieã€‚</h4>
<h4 id="é¿å…-xss-æ”»å‡»çš„æ–¹æ³•">é¿å… XSS æ”»å‡»çš„æ–¹æ³•</h4>
<ul>
  <li>å¯¹ç”¨æˆ·æäº¤çš„æ•°æ®è¿›è¡Œè¿‡æ»¤</li>
  <li>Web ç½‘é¡µæ˜¾ç¤ºæ—¶å¯¹æ•°æ®è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä¸€èˆ¬ä½¿ç”¨ htmlspecialchars() è¾“å‡ºã€‚</li>
</ul>

<p>Laravel çš„ Blade è¯­æ³• {{  }} ä¼šè‡ªåŠ¨è°ƒç”¨ PHP htmlspecialchars å‡½æ•°æ¥é¿å… XSS æ”»å‡»ã€‚ä½†æœ‰äº›æ—¶å€™æˆ‘ä»¬ä¸å¾—ä¸ä½¿ç”¨ {!! !!}æ¥åŸæ ·è¾“å‡ºæ•°æ®ï¼Œæ¯”å¦‚ä½¿ç”¨ WYSIWYG ç¼–è¾‘å™¨æ—¶ã€‚</p>

<p>è§£å†³åŠæ³•ï¼š ä½¿ç”¨ HTMLPurifier for Laravel å¯¹ç”¨æˆ·å†…å®¹è¿›è¡Œè¿‡æ»¤ã€‚</p>

<p><strong>ç”¨ç›‘å¬å™¨åœ¨ç”¨æˆ·æ•°æ®å…¥åº“å‰è¿›è¡Œè¿‡æ»¤æ“ä½œ</strong>ï¼š<br />
<code class="language-plaintext highlighter-rouge">app/Observers/TopicObserver.php</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TopicObserver</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">saving</span><span class="p">(</span><span class="kt">Topic</span> <span class="nv">$topic</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$topic</span><span class="o">-&gt;</span><span class="n">body</span> <span class="o">=</span> <span class="nf">clean</span><span class="p">(</span><span class="nv">$topic</span><span class="o">-&gt;</span><span class="n">body</span><span class="p">,</span> <span class="s1">'user_topic_body'</span><span class="p">);</span>

        <span class="nv">$topic</span><span class="o">-&gt;</span><span class="n">excerpt</span> <span class="o">=</span> <span class="nf">make_excerpt</span><span class="p">(</span><span class="nv">$topic</span><span class="o">-&gt;</span><span class="n">body</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="csrf-è·¨ç«™è¯·æ±‚ä¼ªé€ ">CSRF è·¨ç«™è¯·æ±‚ä¼ªé€ </h3>
<h4 id="è¿™ç§æ”»å‡»å‡­å€Ÿå·²é€šè¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·èº«ä»½æ¥è¿è¡Œæœªç»è¿‡æˆæƒçš„å‘½ä»¤">è¿™ç§æ”»å‡»å‡­å€Ÿå·²é€šè¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·èº«ä»½æ¥è¿è¡Œæœªç»è¿‡æˆæƒçš„å‘½ä»¤ã€‚</h4>
<h4 id="é¿å…-csrf-æ”»å‡»çš„æ–¹æ³•">é¿å… CSRF æ”»å‡»çš„æ–¹æ³•</h4>
<ul>
  <li>Laravel ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªæ´»è·ƒçš„ç”¨æˆ·çš„ä¼šè¯ç”Ÿæˆä¸€ä¸ª CSRFã€Œä»¤ç‰Œã€ã€‚è¯¥ä»¤ç‰Œç”¨äºéªŒè¯ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ˜¯å¦æ˜¯å‘åº”ç”¨ç¨‹åºå‘å‡ºè¯·æ±‚çš„ç”¨æˆ·ã€‚</li>
  <li>
    <p>åœ¨å®šä¹‰ HTMl è¡¨å•æ—¶ï¼ŒåŒ…å«ä¸€ä¸ªéšè—çš„ CSRF æ ‡è®°å­—æ®µã€‚</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">action=</span><span class="s">"/profile"</span><span class="nt">&gt;</span>
  @csrf
  ...
  <span class="nt">&lt;/form&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>X-CSRF-TOKEN ï¼ˆé€šè¿‡éªŒè¯çš„åŒæ—¶ï¼Œè¿˜èƒ½æ–¹ä¾¿Jquery AJAX ä½¿ç”¨ï¼‰</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"csrf-token"</span> <span class="na">content=</span><span class="s">""</span><span class="nt">&gt;</span>
</code></pre></div>    </div>
  </li>
</ul>

<hr />
<h2 id="seo-å‹å¥½çš„-url">SEO å‹å¥½çš„ URL</h2>
<h3 id="ç¬¬ä¸‰æ–¹-api-è°ƒç”¨">ç¬¬ä¸‰æ–¹ API è°ƒç”¨</h3>
<h4 id="ä½¿ç”¨-guzzle-çš„-http-å®¢æˆ·ç«¯æ¥è¯·æ±‚-ç™¾åº¦ç¿»è¯‘-æ¥å£">ä½¿ç”¨ Guzzle çš„ HTTP å®¢æˆ·ç«¯æ¥è¯·æ±‚ <a href="http://api.fanyi.baidu.com/api/trans/product/apidoc">ç™¾åº¦ç¿»è¯‘</a> æ¥å£ã€‚</h4>

<h3 id="é˜Ÿåˆ—ä»»åŠ¡">é˜Ÿåˆ—ä»»åŠ¡</h3>
<h4 id="redis">Redis</h4>
<ul>
  <li>
    <p>ç”Ÿæˆé˜Ÿåˆ—ä»»åŠ¡</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:job TranslateSlug
</code></pre></div>    </div>
  </li>
  <li>
    <p>ç›‘å¬ Topic çš„ saved äº‹ä»¶ï¼Œè§¦å‘åå°†ä»»åŠ¡æ¨é€åˆ°é˜Ÿåˆ—</p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">public</span> <span class="k">function</span> <span class="n">saved</span><span class="p">(</span><span class="kt">Topic</span> <span class="nv">$topic</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="c1">// å¦‚ slug å­—æ®µæ— å†…å®¹ï¼Œå³ä½¿ç”¨ç¿»è¯‘å™¨å¯¹ title è¿›è¡Œç¿»è¯‘</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nv">$topic</span><span class="o">-&gt;</span><span class="n">slug</span><span class="p">)</span> <span class="p">{</span>

          <span class="c1">// æ¨é€ä»»åŠ¡åˆ°é˜Ÿåˆ—</span>
          <span class="nf">dispatch</span><span class="p">(</span><span class="k">new</span> <span class="nc">TranslateSlug</span><span class="p">(</span><span class="nv">$topic</span><span class="p">));</span>
      <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="é˜Ÿåˆ—ç›‘æ§-horizon">é˜Ÿåˆ—ç›‘æ§ Horizon</h4>
<p>Horizon æ˜¯ Laravel ç”Ÿæ€åœˆé‡Œçš„ä¸€å‘˜ï¼Œä¸º Laravel Redis é˜Ÿåˆ—æä¾›äº†ä¸€ä¸ªæ¼‚äº®çš„ä»ªè¡¨æ¿ï¼Œå…è®¸æˆ‘ä»¬å¾ˆæ–¹ä¾¿åœ°æŸ¥çœ‹å’Œç®¡ç† Redis é˜Ÿåˆ—ä»»åŠ¡æ‰§è¡Œçš„æƒ…å†µã€‚</p>

<hr />
<h2 id="æ¨¡å‹ç›‘å¬">æ¨¡å‹ç›‘å¬</h2>
<h3 id="æ¨¡å‹è§‚å¯Ÿå™¨ç›‘æ§-eloquent-æ¨¡å‹äº‹ä»¶">æ¨¡å‹è§‚å¯Ÿå™¨ç›‘æ§ Eloquent æ¨¡å‹äº‹ä»¶</h3>

<hr />
<h2 id="å¤šè§’è‰²æƒé™ç®¡ç†">å¤šè§’è‰²æƒé™ç®¡ç†</h2>
<h3 id="è§’è‰²æ˜¯ç”¨æˆ·åœ¨ç«™ç‚¹ä¸­çš„èº«ä»½å¾ˆå¤šæ—¶å€™ä¸ç«™ç‚¹æƒé™ç›¸å…³è”">è§’è‰²æ˜¯ç”¨æˆ·åœ¨ç«™ç‚¹ä¸­çš„èº«ä»½ï¼Œå¾ˆå¤šæ—¶å€™ä¸ç«™ç‚¹æƒé™ç›¸å…³è”</h3>
<p>åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªè§’è‰²ï¼Œæƒé™ç”±ä½åˆ°é«˜ï¼š</p>
<ul>
  <li>æ¸¸å®¢ â€”â€” æ²¡æœ‰ç™»å½•çš„ç”¨æˆ·</li>
  <li>ç”¨æˆ· â€”â€” ç™»å½•ç”¨æˆ·</li>
  <li>ç®¡ç†å‘˜ â€”â€” ç¤¾åŒºå†…å®¹ç®¡ç†</li>
  <li>ç«™é•¿ â€”â€” æƒé™æœ€é«˜çš„ç”¨æˆ·è§’è‰²</li>
</ul>

<h3 id="æƒé™ç®¡ç†æ‰©å±•åŒ…-laravel-permission">æƒé™ç®¡ç†æ‰©å±•åŒ… Laravel-permission</h3>
<p>æ•°æ®è¡¨ç»“æ„ï¼š</p>
<ul>
  <li>roles â€”â€” è§’è‰²çš„æ¨¡å‹è¡¨ï¼›</li>
  <li>permissions â€”â€” æƒé™çš„æ¨¡å‹è¡¨ï¼›</li>
  <li>model_has_roles â€”â€” æ¨¡å‹ä¸è§’è‰²çš„å…³è”è¡¨ï¼Œç”¨æˆ·æ‹¥æœ‰ä»€ä¹ˆè§’è‰²åœ¨æ­¤è¡¨ä¸­å®šä¹‰ï¼Œä¸€ä¸ªç”¨æˆ·èƒ½æ‹¥æœ‰å¤šä¸ªè§’è‰²ï¼›</li>
  <li>role_has_permissions â€”â€” è§’è‰²æ‹¥æœ‰çš„æƒé™å…³è”è¡¨ï¼Œå¦‚ç®¡ç†å‘˜æ‹¥æœ‰æŸ¥çœ‹åå°çš„æƒé™éƒ½æ˜¯åœ¨æ­¤è¡¨å®šä¹‰ï¼Œä¸€ä¸ªè§’è‰²èƒ½æ‹¥æœ‰å¤šä¸ªæƒé™ï¼›</li>
  <li>model_has_permissions â€”â€” æ¨¡å‹ä¸æƒé™å…³è”è¡¨ï¼Œä¸€ä¸ªæ¨¡å‹èƒ½æ‹¥æœ‰å¤šä¸ªæƒé™ã€‚</li>
</ul>

<h3 id="ç®¡ç†åå°æ‰©å±•åŒ…-laravel-administrator">ç®¡ç†åå°æ‰©å±•åŒ… Laravel Administrator</h3>
<p>è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ã€Œé…ç½®ä¿¡æ¯ã€æ¥å¿«é€Ÿç”Ÿæˆç®¡ç†å‘˜åå°çš„å¼€å‘ç†å¿µï¼Œå‡ åˆ†é’Ÿå†…å°±èƒ½æ‹¥æœ‰ä¸€ä¸ªå¯ç”¨çš„åå°ã€‚</p>

<hr />
<h2 id="è®¡åˆ’ä»»åŠ¡">è®¡åˆ’ä»»åŠ¡</h2>
<p>é€šè¿‡ Laravel å‘½ä»¤è°ƒåº¦å™¨åœ¨ Laravel ä¸­å¯¹å‘½ä»¤è°ƒåº¦è¿›è¡Œæ¸…æ™°æµç•…çš„å®šä¹‰ï¼Œè¿™æ ·åªéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå¢åŠ ä¸€æ¡ Cron é¡¹ç›®å³å¯ã€‚è°ƒåº¦åœ¨ app/Console/Kernel.php æ–‡ä»¶çš„ schedule æ–¹æ³•ä¸­å®šä¹‰ï¼Œè¿˜èƒ½å—åˆ°ç‰ˆæœ¬æ§åˆ¶ã€‚</p>
<h3 id="ä¿®æ”¹ç³»ç»Ÿçš„-cron-è®¡åˆ’ä»»åŠ¡é…ç½®ä¿¡æ¯">ä¿®æ”¹ç³»ç»Ÿçš„ Cron è®¡åˆ’ä»»åŠ¡é…ç½®ä¿¡æ¯</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">EDITOR</span><span class="o">=</span>vim <span class="o">&amp;&amp;</span> crontab <span class="nt">-e</span>
</code></pre></div></div>

<p>å¢åŠ ä¸‹é¢è¿™è¡Œï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* * * * * php /home/vagrant/Code/larabbs/artisan schedule:run &gt;&gt; /dev/null 2&gt;&amp;1
</code></pre></div></div>

<p>ç³»ç»Ÿçš„ Cron å·²ç»è®¾å®šå¥½äº†ï¼Œç°åœ¨ Cron è½¯ä»¶å°†ä¼šæ¯åˆ†é’Ÿè°ƒç”¨ä¸€æ¬¡ Laravel å‘½ä»¤è°ƒåº¦å™¨ï¼Œå½“ <code class="language-plaintext highlighter-rouge">schedule:run</code> å‘½ä»¤æ‰§è¡Œæ—¶ï¼Œ Laravel ä¼šè¯„ä¼°ä½ çš„è®¡åˆ’ä»»åŠ¡å¹¶è¿è¡Œé¢„å®šä»»åŠ¡ã€‚</p>

<p>æ³¨å†Œè°ƒåº¦ä»»åŠ¡<br />
<code class="language-plaintext highlighter-rouge">app/Console/Kernel.php</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="k">function</span> <span class="n">schedule</span><span class="p">(</span><span class="kt">Schedule</span> <span class="nv">$schedule</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ä¸€å°æ—¶æ‰§è¡Œä¸€æ¬¡ã€æ´»è·ƒç”¨æˆ·ã€æ•°æ®ç”Ÿæˆçš„å‘½ä»¤</span>
        <span class="nv">$schedule</span><span class="o">-&gt;</span><span class="nf">command</span><span class="p">(</span><span class="s1">'larabbs:calculate-active-user'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">hourly</span><span class="p">();</span>
    <span class="p">}</span>
</code></pre></div></div>

<hr />
<h2 id="ç”¨æˆ·æœ€åç™»å½•æ—¶é—´">ç”¨æˆ·æœ€åç™»å½•æ—¶é—´</h2>
<h3 id="åŸºæœ¬æ€è·¯">åŸºæœ¬æ€è·¯ï¼š</h3>
<ol>
  <li>è®°å½• - é€šè¿‡ä¸­é—´ä»¶è¿‡æ»¤ç”¨æˆ·æ‰€æœ‰è¯·æ±‚ï¼Œè®°å½•ç”¨æˆ·è®¿é—®æ—¶é—´åˆ° Redis æŒ‰æ—¥æœŸåŒºåˆ†çš„å“ˆå¸Œè¡¨ï¼›</li>
  <li>åŒæ­¥ - æ–°å»ºå‘½ä»¤ï¼Œè®¡åˆ’ä»»åŠ¡æ¯å¤©è¿è¡Œä¸€æ¬¡æ­¤å‘½ä»¤ï¼Œå°†æ˜¨æ—¥å“ˆå¸Œè¡¨é‡Œçš„æ•°æ®åŒæ­¥åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶åˆ é™¤ï¼›</li>
  <li>è¯»å– - ä¼˜å…ˆè¯»å–å½“æ—¥å“ˆå¸Œè¡¨é‡Œ Redis é‡Œçš„æ•°æ®ï¼Œæ— æ•°æ®åˆ™ä½¿ç”¨æ•°æ®åº“ä¸­çš„å€¼ã€‚</li>
</ol>

<h3 id="è‡ªå®šä¹‰-middleware-ä¸­é—´ä»¶">è‡ªå®šä¹‰ Middleware ä¸­é—´ä»¶</h3>
<h4 id="åˆ©ç”¨-laravel-ä¸­é—´ä»¶-åŠŸèƒ½æ¥å®ç°ç”¨æˆ·è®¿é—®æ—¶é—´çš„è®°å½•">åˆ©ç”¨ <a href="https://learnku.com/docs/laravel/7.x/middleware">Laravel ä¸­é—´ä»¶</a> åŠŸèƒ½æ¥å®ç°ç”¨æˆ·è®¿é—®æ—¶é—´çš„è®°å½•ã€‚</h4>
<p>åˆ›å»ºä¸­é—´ä»¶</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:middleware RecordLastActivedTime
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">app/Http/Middleware/RecordLastActivedTime.php</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="kt">Closure</span> <span class="nv">$next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// å¦‚æœæ˜¯ç™»å½•ç”¨æˆ·çš„è¯</span>
        <span class="k">if</span> <span class="p">(</span><span class="nc">Auth</span><span class="o">::</span><span class="nf">check</span><span class="p">())</span> <span class="p">{</span>
            <span class="c1">// è®°å½•æœ€åç™»å½•æ—¶é—´</span>
            <span class="nc">Auth</span><span class="o">::</span><span class="nf">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">recordLastActivedAt</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>æ³¨å†Œä¸­é—´ä»¶ <code class="language-plaintext highlighter-rouge">app/Http/Kernel.php</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="nv">$middlewareGroups</span> <span class="o">=</span> <span class="p">[</span>

        <span class="c1">// Web ä¸­é—´ä»¶ç»„ï¼Œåº”ç”¨äº routes/web.php è·¯ç”±æ–‡ä»¶ï¼Œ</span>
        <span class="c1">// åœ¨ RouteServiceProvider ä¸­è®¾å®š</span>
        <span class="s1">'web'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="mf">...</span>
            <span class="c1">// è®°å½•ç”¨æˆ·æœ€åæ´»è·ƒæ—¶é—´</span>
            <span class="err">\</span><span class="nc">App\Http\Middleware\RecordLastActivedTime</span><span class="o">::</span><span class="n">class</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="mf">...</span>
    <span class="p">];</span>
</code></pre></div></div>

<h3 id="è‡ªå®šä¹‰-artisan-å‘½ä»¤">è‡ªå®šä¹‰ Artisan å‘½ä»¤</h3>
<h4 id="æ–°å»ºå‘½ä»¤">æ–°å»ºå‘½ä»¤</h4>
<p>ç»ˆç«¯ä¸­æ‰§è¡Œï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:command SyncUserActivedAt <span class="nt">--command</span><span class="o">=</span>larabbs:sync-user-actived-at
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">app/Console/Commands/SyncUserActivedAt.php</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="nv">$signature</span> <span class="o">=</span> <span class="s1">'larabbs:sync-user-actived-at'</span><span class="p">;</span>
<span class="k">protected</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s1">'å°†ç”¨æˆ·æœ€åç™»å½•æ—¶é—´ä» Redis åŒæ­¥åˆ°æ•°æ®åº“ä¸­'</span><span class="p">;</span>

<span class="k">public</span> <span class="k">function</span> <span class="n">handle</span><span class="p">(</span><span class="kt">User</span> <span class="nv">$user</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$user</span><span class="o">-&gt;</span><span class="nf">syncUserActivedAt</span><span class="p">();</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">info</span><span class="p">(</span><span class="s2">"åŒæ­¥æˆåŠŸï¼"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="æ‰§è¡Œå‘½ä»¤">æ‰§è¡Œå‘½ä»¤</h4>
<p>ç»ˆç«¯ä¸­æ‰§è¡Œï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan larabbs:sync-user-actived-at
</code></pre></div></div>

<h4 id="æ¯å¤©é›¶æ—¶-0000-è‡ªåŠ¨å¯¹æ•°æ®è¿›è¡ŒåŒæ­¥é€šè¿‡-laravel-ä»»åŠ¡è°ƒåº¦å®ç°æ­¤åŠŸèƒ½">æ¯å¤©é›¶æ—¶ 00:00 è‡ªåŠ¨å¯¹æ•°æ®è¿›è¡ŒåŒæ­¥ã€‚é€šè¿‡ Laravel ä»»åŠ¡è°ƒåº¦å®ç°æ­¤åŠŸèƒ½ã€‚</h4>
<p><code class="language-plaintext highlighter-rouge">app/Console/Kernel.php</code></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="k">function</span> <span class="n">schedule</span><span class="p">(</span><span class="kt">Schedule</span> <span class="nv">$schedule</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// æ¯æ—¥é›¶æ—¶æ‰§è¡Œä¸€æ¬¡</span>
        <span class="nv">$schedule</span><span class="o">-&gt;</span><span class="nf">command</span><span class="p">(</span><span class="s1">'larabbs:sync-user-actived-at'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">dailyAt</span><span class="p">(</span><span class="s1">'00:00'</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<hr />
<h2 id="æ¶ˆæ¯é€šçŸ¥">æ¶ˆæ¯é€šçŸ¥</h2>
<h3 id="laravel-çš„æ¶ˆæ¯é€šçŸ¥ç³»ç»Ÿ">Laravel çš„æ¶ˆæ¯é€šçŸ¥ç³»ç»Ÿ</h3>
<h4 id="é€šçŸ¥é¢‘é“æœ‰æ•°æ®åº“é‚®ä»¶çŸ­ä¿¡é€šè¿‡-nexmoä»¥åŠ-slack">é€šçŸ¥é¢‘é“æœ‰æ•°æ®åº“ã€é‚®ä»¶ã€çŸ­ä¿¡ï¼ˆé€šè¿‡ Nexmoï¼‰ä»¥åŠ Slackã€‚</h4>
<h4 id="å½“-topic-æœ‰æ–°-reply-æ—¶é€šçŸ¥ä½œè€…">å½“ Topic æœ‰æ–° reply æ—¶ï¼Œé€šçŸ¥ä½œè€…</h4>
<ol>
  <li>å‡†å¤‡æ•°æ®åº“</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan notifications:table

php artisan migrate
</code></pre></div></div>

<p>å¹¶åœ¨ç”¨æˆ·è¡¨åŠ å…¥æ¶ˆæ¯è®¡æ•°å­—æ®µã€‚</p>

<ol>
  <li>ç”Ÿæˆé€šçŸ¥ç±»</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:notification TopicReplied
</code></pre></div></div>

<ol>
  <li>åœ¨æ¨¡å‹ç›‘å¬å™¨ä¸­ç›‘å¬ reply çš„ created äº‹ä»¶ï¼Œè§¦å‘åä½¿ç”¨ notify() å‘é€é€šçŸ¥</li>
</ol>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// é€šçŸ¥è¯é¢˜ä½œè€…æœ‰æ–°çš„è¯„è®º</span>
<span class="nv">$reply</span><span class="o">-&gt;</span><span class="n">topic</span><span class="o">-&gt;</span><span class="n">user</span><span class="o">-&gt;</span><span class="nf">notify</span><span class="p">(</span><span class="k">new</span> <span class="nc">TopicReplied</span><span class="p">(</span><span class="nv">$reply</span><span class="p">));</span>
</code></pre></div></div>
:ET